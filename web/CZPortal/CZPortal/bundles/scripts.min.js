"use strict";!function(){function t(t,e,a){function n(t,e){return{request:function(t){var a=screen.width,n=screen.height,o=e.path();return setTimeout(function(){o.indexOf("main")>-1&&($(".section").css({height:n/2+"px",width:a/2+"px"}),$(".section-main").css({height:n+"px",width:a+"px"}),$(".section-center").css({height:n/2+"px",width:a+"px"}),$(".section h1").css({"line-height":"2rem"}),$(".chart-idc-use").css({height:"66%"}),$(".idcuse-desc p").css({"font-size":"0.9rem"}),$(".idcuse-desc p strong").css({"font-size":"1rem"})),(o.indexOf("dept")>-1||o.indexOf("standard")>-1||o.indexOf("support")>-1||o.indexOf("datamap")>-1||o.indexOf("idcuse")>-1||o.indexOf("bigdata")>-1)&&($(".section").css({height:n+"px",width:a+"px"}),$("body").css({overflow:"hidden"})),o.indexOf("dashboard")>-1&&($("html").css({"font-size":"16px"}),$("#dashboard").css({height:n+"px",width:a+"px"}),$(".section").css({height:n/2+"px",width:a/4+"px"}),$(".section-center").css({height:n/2+"px",width:a/2+"px"}),$(".section.city-datamap").css({position:"absolute",top:n/2+"px",left:a/4+"px"}),$(".section.idcuse").css({position:"absolute",top:n/2+"px",right:a/4+"px"}),$(".section.bigdata").css({position:"absolute",top:n/2+"px",left:0}),$(".section.standard").css({position:"absolute",top:n/2+"px",right:0}))},500),t},response:function(e){return t.when(e,function(t){}),e}}}e.otherwise("/dashboard"),t.state("dashboard",{url:"/dashboard",templateUrl:"partials/dashboard/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("standard",{url:"/standard",templateUrl:"partials/standard/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("center",{url:"/center",templateUrl:"partials/center/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("main",{url:"/main",templateUrl:"partials/main/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("bigdata",{url:"/bigdata",templateUrl:"partials/bigdata/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("support",{url:"/support",templateUrl:"partials/support/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("datamap",{url:"/datamap",templateUrl:"partials/datamap/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("idcuse",{url:"/idcuse",templateUrl:"partials/idcuse/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("dept",{url:"/dept",templateUrl:"partials/dept/view.html",controller:"deptController",controllerAs:"dept"}),a.interceptors.push(n),n.$inject=["$q","$location"]}angular.module("app",["ngAnimate","ui.router","common.http","app.dashboard","app.dept","app.catalog"]).config(t),t.$inject=["$stateProvider","$urlRouterProvider","$httpProvider"]}(),function(){var t=angular.module("common.http",[]);t.constant("URL",location.protocol+"//"+location.host+"/BigScreenShow/data"),t.factory("validate",[function(){return function(t,e){var a=function(e){return t&&t.head&&t.head.status===e};switch(e){case 200:return a(e);case 201:return a(e);case 202:return a(e);case 400:return a(e);case 404:return a(e);case 405:return a(e);case 415:return a(e);case 500:return a(e)}}}])}(),function(){var t=angular.module("app.dashboard",[]);t.$inject=["$location"],t.controller("dashboardController",["$scope","dashboardService","$rootScope","$interval","$timeout",function(t,e,a,n,o){function r(){t.CivilServant={};var e=Number(localStorage.getItem("all")),a=Number(localStorage.getItem("careerPersonnel")),n=Number(localStorage.getItem("onTheJob")),o=Number(localStorage.getItem("beLate")),r=Number(localStorage.getItem("leaveEarly")),i=Number(localStorage.getItem("daily")),l=Number(localStorage.getItem("weekly")),c=Number(localStorage.getItem("quarter"));e?t.CivilServant.all=e:(t.CivilServant.all=Math.round(99*Math.random()+3042),localStorage.setItem("all",t.CivilServant.all)),a?t.CivilServant.careerPersonnel=a:(t.CivilServant.careerPersonnel=1e3,localStorage.setItem("careerPersonnel",t.CivilServant.careerPersonnel)),n?t.CivilServant.onTheJob=n:(t.CivilServant.onTheJob=0+t.CivilServant.all+t.CivilServant.careerPersonnel-Math.round(20*Math.random()+30),localStorage.setItem("onTheJob",t.CivilServant.onTheJob)),o?t.CivilServant.beLate=o:(t.CivilServant.beLate=Math.round(20*Math.random()+30),localStorage.setItem("beLate",t.CivilServant.beLate)),r?t.CivilServant.leaveEarly=r:(t.CivilServant.leaveEarly=Math.round(20*Math.random()+30),localStorage.setItem("leaveEarly",t.CivilServant.leaveEarly)),i?t.CivilServant.daily=i:(t.CivilServant.daily=0+t.CivilServant.all+t.CivilServant.careerPersonnel-Math.round(20*Math.random()+30),localStorage.setItem("daily",t.CivilServant.daily)),l?t.CivilServant.weekly=l:(t.CivilServant.weekly=0+t.CivilServant.all+t.CivilServant.careerPersonnel-Math.round(20*Math.random()+30),localStorage.setItem("weekly",t.CivilServant.weekly)),c?t.CivilServant.quarter=c:(t.CivilServant.quarter=0+t.CivilServant.all+t.CivilServant.careerPersonnel-Math.round(200*Math.random()+500),localStorage.setItem("quarter",t.CivilServant.quarter))}var i=this;a.change_flag=!1,t.update_day_date=new Date,t.update_date=new Date,t.current_tab=1,o(function(){$("#menu-scroll").slick({infinite:!0,slidesToShow:5,slidesToScroll:1,autoplay:!0,autoplaySpeed:3e4,vertical:!0,verticalSwiping:!0})},1e3),n(function(){},5e4),$("#menu-scroll").on("beforeChange",function(e,a,n,r){t.current_tab=r+1,console.log(t.current_tab),5==t.current_tab&&o(function(){$(".weather-scroll").slick({infinite:!0,slidesToShow:2,slidesToScroll:1,cssEase:"linear",autoplay:!0,centerMode:!0,autoplaySpeed:0,speed:7e3,vertical:!0,verticalSwiping:!0})},500)}),t.toggle=function(e){t.current_tab=e,$("#menu-scroll").slick("slickGoTo",e-1)};var l=function(){e.getVehicle().then(function(e){var a=e.data.body[0];a&&void 0!=a.yesterday&&void 0!=a.week&&void 0!=a.month&&void 0!=a.all?(localStorage.setItem("veh_yesterday",a.yesterday),localStorage.setItem("veh_week",a.week),localStorage.setItem("veh_month",a.month),localStorage.setItem("veh_all",a.all)):(a={},a.yesterday=localStorage.getItem("veh_yesterday"),a.week=localStorage.getItem("veh_week"),a.month=localStorage.getItem("veh_month"),a.all=localStorage.getItem("veh_all")),t.Vehicle=a})},c=function(){e.getCivilServant().then(function(t){r()})};n(function(){t.CivilServant.onTheJob=t.CivilServant.all+t.CivilServant.careerPersonnel-Math.round(20*Math.random()+30),localStorage.setItem("onTheJob",t.CivilServant.onTheJob),t.CivilServant.beLate=Math.round(20*Math.random()+30),localStorage.setItem("beLate",t.CivilServant.beLate),t.CivilServant.leaveEarly=Math.round(20*Math.random()+30),localStorage.setItem("leaveEarly",t.CivilServant.leaveEarly),t.CivilServant.daily=t.CivilServant.all+t.CivilServant.careerPersonnel-Math.round(20*Math.random()+30),localStorage.setItem("daily",t.CivilServant.daily)},864e5),n(function(){t.CivilServant.weekly=t.CivilServant.all+t.CivilServant.careerPersonnel-Math.round(20*Math.random()+30),localStorage.setItem("weekly",t.CivilServant.weekly)},6048e5);var s=function(){e.getGovernmentApprovalSystem().then(function(e){t.GovernmentApprovalSystem=e.data.body[0]})},d=function(){e.getMeteorologicalObservationStation().then(function(e){t.MeteorologicalObservationStation=e.data.body[0]}),e.getMos_maxTemperature().then(function(e){var a=e.data.body[0];a&&void 0!=a.zgqw?(localStorage.setItem("zgqw",a.zgqw),localStorage.setItem("zgqw_zm",a.zm),localStorage.setItem("zgqw_rksj",a.rksj)):(a={},a.zgqw=localStorage.getItem("zgqw"),a.zm=localStorage.getItem("zgqw_zm"),a.rksj=localStorage.getItem("zgqw_rksj")),t.Mos_maxTemperature=a}),e.getMos_minTemperature().then(function(e){var a=e.data.body[0];a&&void 0!=a.zdqw?(localStorage.setItem("zdqw",a.zdqw),localStorage.setItem("zdqw_zm",a.zm),localStorage.setItem("zdqw_rksj",a.rksj)):(a={},a.zdqw=localStorage.getItem("zdqw"),a.zm=localStorage.getItem("zdqw_zm"),a.rksj=localStorage.getItem("zdqw_rksj")),t.Mos_minTemperature=a}),e.getMos_maxRainfall().then(function(e){var a=e.data.body[0];a&&void 0!=a.yxsyl?(localStorage.setItem("yxsyl",a.yxsyl),localStorage.setItem("yxsyl_zm",a.zm),localStorage.setItem("yxsyl_rksj",a.rksj)):(a={},a.yxsyl=localStorage.getItem("yxsyl"),a.zm=localStorage.getItem("yxsyl_zm"),a.rksj=localStorage.getItem("yxsyl_rksj")),t.Mos_maxRainfall=a})},u=function(){t.hide_weather=!1,e.getWeatherForecast().then(function(e){e&&e.data&&e.data.body&&e.data.body[0]?(t.hide_weather=!1,t.WeatherForecast=e.data.body[0]):t.hide_weather=!0}),t.hide_disaster=!1,e.getDisasterWarning().then(function(e){t.DisasterWarning=e.data.body,t.DisasterWarning&&t.DisasterWarning.length>0||(t.hide_disaster=!0)})};t.getTimingData=function(){e.getDisasterWarning().then(function(e){t.DisasterWarning=e.data.body,t.DisasterWarning&&t.DisasterWarning.length>0?(t.hide_disaster=!1,o(function(){$(".weather-scroll").slick({slidesToShow:2,slidesToScroll:1,cssEase:"linear",autoplay:!0,centerMode:!0,autoplaySpeed:0,speed:7e3,vertical:!0,verticalSwiping:!0})},300)):t.hide_disaster=!0})},t.getWeatherData=function(){e.getWeatherForecast().then(function(e){e&&e.data&&e.data.body&&e.data.body[0]?(t.hide_weather=!1,t.WeatherForecast=e.data.body[0]):t.hide_weather=!0})};var p=function(){e.getCreditWebOne().then(function(e){t.CreditWebOne=e.data.body[0]}),e.getCreditWebTwo().then(function(e){t.CreditWebTwo=e.data.body[0]}),e.getCreditWebThree().then(function(e){t.CreditWebThree=e.data.body[0]}),t.entries=[{label:"社保登记",color:"#01ccd1"},{label:"税务登记"},{label:"司法行政登记",color:"#01ccd1"},{label:"事业单位登记"},{label:"企业注册人"},{label:"市场主体退出（注销）"},{label:"市场主体退出（吊销）",color:"#01ccd1"},{label:"事业单位年报"},{label:"机关群团登记"},{label:"诚信企业评价",color:"#01ccd1"},{label:"批评谴责",color:"#01ccd1"},{label:"失信被执行人"},{label:"水电欠费信息"},{label:"司法执行"},{label:"司法判决"},{label:"产品质量监督抽查"},{label:"拖欠公积金"},{label:"表彰奖励"},{label:"中小企业信用等级"},{label:"食品生产经营企业监管等级",color:"#01ccd1"},{label:"纳税信用评级"},{label:"其它行政处理措施",color:"#01ccd1"},{label:"重大税收违法"},{label:"行政奖励"},{label:"行政强制措施"},{label:"工商局行政处罚",color:"#01ccd1"},{label:"行政处罚"},{label:"民政登记",color:"#01ccd1"},{label:"商标"},{label:"专利"},{label:"动产抵押"},{label:"对外贸易经营者备案登记",color:"#01ccd1"},{label:"绿色食品"},{label:"农产品地理标志"},{label:"无公害农产品"},{label:"行业资质资格",color:"#01ccd1"},{label:"行政许可",color:"#01ccd1"},{label:"市场主体退出",color:"#01ccd1"},{label:"股权出质"},{label:"消费者投诉站"},{label:"协会成员单位",color:"#01ccd1"},{label:"机构代码证发放"},{label:"公积金缴存登记"},{label:"市场主体"}];({entries:t.entries,width:900,height:400,radius:"40%",radiusMin:175,bgDraw:!0,bgColor:"transparent",opacityOver:1,opacityOut:.05,opacitySpeed:10,fov:1e3,speed:.2,fontFamily:"Oswald, Arial, sans-serif",fontSize:"18",fontColor:"#fff",fontWeight:"normal",fontStyle:"normal",fontStretch:"normal",fontToUpperCase:!0});o(function(){var t={textFont:"Arial, Helvetica, sans-serif",maxSpeed:.05,minSpeed:.01,textColour:null,textHeight:12,outlineMethod:"colour",fadeIn:800,outlineColour:"#41b1c3",outlineOffset:0,depth:.97,minBrightness:.2,wheelZoom:!1,reverse:!0,shadowBlur:2,shuffleTags:!0,shadowOffset:[1,1],stretchX:1.6,initial:[0,.1],clickToFront:600,maxSpeed:.01,outlineDashSpeed:.5},e=(new Date).getTime()/360;t.initial[0]=.18*Math.cos(e),t.initial[1]=.18*Math.sin(e),$("#myCanvas").tagcanvas(t,"tags")||$("#myCanvasContainer").hide()},600)},m=function(){e.getIndustrialPolicy().then(function(e){t.IndustrialPolicy=e.data.body,_.forEach(t.IndustrialPolicy,function(t,e){e%3==0?t.itemStyle="item-up":e%3==1?t.itemStyle="item-center":t.itemStyle="item-down"}),o(function(){$("#pro-list").slick({slidesToShow:3,slidesToScroll:1,autoplay:!0,autoplaySpeed:3e3,vertical:!0,verticalSwiping:!0})},500)})},g=function(){e.getDeptDataQuantity().then(function(t){var e=t.data.body[0];e&&(i.deptData=e)}),e.getDataCount().then(function(t){var e=t.data.body[0];e&&(i.deptDataCount=e)}),l(),c(),s(),d(),u(),p(),m()};g(),t.toggleDept=function(){if(t.allow_toggle){var e=angular.copy(t.toggleMap);t.toggleMap=(e+1)%3,1==t.toggleMap&&(_.forEach(t.deptAccessData,function(t){t.i_width="0%"}),o(function(){_.forEach(t.deptAccessData,function(e){e.i_width=e.dataNum/t.deptAccessMax*100+"%"}),$(".dept-access-rank").slick("slickGoTo",0)},100))}},t.toggleBigdata=function(){t.allow_ipc_toggle&&(t.toggleIPC?t.toggleIPC=!1:t.toggleIPC=!0)},t.bigdataToggleClick=function(){t.allow_ipc_toggle=!0,t.toggleBigdata()},t.toggleIPC=!1,t.deptViewTitle="切换视图",n(function(){t.toggleBigdata()},3e4),t.allow_toggle=!0,t.mouseEnter=function(){console.log("mouse enter...."),t.allow_toggle=!1},t.mouseLeave=function(){console.log("mouse leave...."),t.allow_toggle=!0},t.allow_ipc_toggle=!0,t.mouseIPCEnter=function(){t.allow_ipc_toggle=!1},t.mouseIPCLeave=function(){t.allow_ipc_toggle=!0},n(function(){t.update_day_date=new Date},864e5),n(function(){u()},9e5),n(function(){d(),l(),c(),s(),p(),m(),t.update_date=new Date},36e5),t.changeRoute=function(){e.getStatus().then(function(t){var a=t.data,n="";n=1==a?"":1,e.setStatus(n).then(function(){})})}}]),t.factory("dashboardService",["$http","URL",function(t,e){function a(){return t.get(e+"/depDataInfo/quantity")}function n(){return t.get(e+"/status/get")}function o(){return t.get(e+"/serverMonitor/detail")}function r(){return t.get(e+"/serverMonitor/detailTime")}function i(a){return t.put(e+"/status/set?value="+a)}function l(){return t.get(e+"/depDataInfo/dataInfoNum")}function c(){return t.get(e+"/depDataInfo/dataCount")}function s(){return t.get(e+"/sixApp/vehicle")}function d(){return t.get(e+"/sixApp/vehicleView")}function u(){return t.get(e+"/sixApp/civilServant")}function p(){return t.get(e+"/sixApp/governmentApprovalSystem")}function m(){return t.get(e+"/sixApp/meteorologicalObservationStation")}function g(){return t.get(e+"/sixApp/mos_maxTemperature")}function h(){return t.get(e+"/sixApp/mos_minTemperature")}function b(){return t.get(e+"/sixApp/mos_maxRainfall")}function f(){return t.get(e+"/sixApp/weatherForecast")}function v(){return t.get(e+"/sixApp/disasterWarning")}function y(){return t.get(e+"/sixApp/creditWebOne")}function S(){return t.get(e+"/sixApp/creditWebTwo")}function w(){return t.get(e+"/sixApp/creditWebThree")}function _(){return t.get(e+"/depDataInfo/industrialPolicy")}return{getDeptDataQuantity:a,getStatus:n,getIdcUse:o,getIdcUseTime:r,setStatus:i,getDataInfoNum:l,getDataCount:c,getVehicle:s,getVehicleView:d,getCivilServant:u,getGovernmentApprovalSystem:p,getMeteorologicalObservationStation:m,getMos_maxTemperature:g,getMos_minTemperature:h,getMos_maxRainfall:b,getWeatherForecast:f,getDisasterWarning:v,getCreditWebOne:y,getCreditWebTwo:S,getCreditWebThree:w,getIndustrialPolicy:_}}]),t.directive("wiservDockProgress",["dashboard.chartDockProgress",function(t){return{restrict:"ACE",template:"<div id='dockProgress'></div>",link:function(t,e,a){var n=screen.width,o=4;n<2e3&&(o=4),n<1600&&(o=3);var r={title:{text:"对接进度",left:"center",top:15,textStyle:{color:"rgb(0,225,252)",fontSize:8*o,fontWeight:"normal"}},tooltip:{trigger:"axis"},radar:[{indicator:[{text:"市民一卡通系统",max:70},{text:"气象观测系统",max:70,axisLabel:!1},{text:"成都市公共气象服务平台",max:70,axisLabel:!1},{text:"公务员管理系统",max:70,axisLabel:!1},{text:"综合执法智慧服务平台",max:70,axisLabel:!1},{text:"成都市企业信用系统 ",max:70,axisLabel:!1},{text:"成都崇州行政审批系统 ",max:70,axisLabel:!1},{text:"数字化城管系统 ",max:70,axisLabel:!1},{text:"省行权平台 ",max:70,axisLabel:!1}],center:["52%","55%"],radius:50*o,splitNumber:7,name:{formatter:"{value}",textStyle:{color:"rgba(220, 220, 220, 1)",fontSize:4*o}},splitArea:{areaStyle:{color:["transparent"],shadowColor:"rgba(0, 0, 0, 0.3)",shadowBlur:10}},axisLine:{show:!1,lineStyle:{color:"rgba(255, 255, 255, 0.5)"}},splitLine:{lineStyle:{color:"rgba(204, 204, 204, 0.3)"}},axisLabel:{show:!0,formatter:"{value}%",textStyle:{color:"#DDD"}}}],series:[{name:"雷达图",type:"radar",tooltip:{trigger:"item"},itemStyle:{emphasis:{lineStyle:{width:4}}},data:[{value:[60,30,60,10,50,20,68,50,10],name:"对接进度",symbolSize:5,lineStyle:{normal:{color:"rgb(69,128,180)",width:2,shadowColor:"rgb(94,154,208)",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:12}},itemStyle:{normal:{color:"rgb(69,128,180)"}}}]}]},i=echarts.init(e.find("#dockProgress")[0]);setTimeout(function(){var t=e.find("#dockProgress")[0].clientWidth;$("#dockProgress").css({width:t}),i.clear(),i.resize(),i.setOption(r)},1e3)}}}]),t.directive("wiservDockDataset",["dashboard.chartDockDataset",function(t){return{restrict:"ACE",template:"<div id='dockDataset'></div>",link:function(t,e,a){var n=screen.width,o=4;n<2e3&&(o=4),n<1600&&(o=3);var r={title:{text:"对接后采集到平台的数据项",left:"center",top:48,textStyle:{color:"rgb(0,225,252)",fontSize:8*o,fontWeight:"normal"}},color:["#3398DB"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{top:"24%",left:"3%",right:"4%",bottom:"20%",containLabel:!0},xAxis:[{type:"category",data:["市民一卡通系统","省行权平台","数字化城管系统","成都崇州行政审批系统","成都市企业信用系统","综合执法智慧服务平台","公务员管理系统","成都市公共气象服务平台","气象观测系统"],axisTick:{alignWithLabel:!0},axisLabel:{rotate:45,interval:0,textStyle:{color:"rgba(220, 220, 220, 1)",fontSize:4*o}},axisLine:{lineStyle:{color:"rgba(204, 204, 204, 0.5)"}}}],yAxis:[{type:"value",axisTick:{show:!1},axisLine:{show:!1},axisLabel:{textStyle:{color:"rgba(220, 220, 220, 1)",fontSize:3*o}},splitLine:{lineStyle:{color:["rgba(204, 204, 204, 0.5)"]}}}],series:[{name:"采集数据项",type:"bar",barWidth:"45%",label:{normal:{show:!0,position:"top",textStyle:{color:"rgba(240, 240, 240, 1)",fontSize:3*o}}},itemStyle:{normal:{color:"rgb(0,112,192)",shadowColor:"rgb(8, 152, 255)",shadowBlur:8}},data:[16,5,15,4,16,28,18,37,24]}]},i=echarts.init(e.find("#dockDataset")[0]);setTimeout(function(){var t=e.find("#dockDataset")[0].clientWidth;$("#dockDataset").css({width:t}),i.clear(),i.resize(),i.setOption(r)},2e3)}}}]),t.directive("wiservChartCar",["dashboardService","$interval",function(t,e){return{restrict:"ACE",template:"<div id='carData' style='width:100%;height:100%'></div>",link:function(a,n,o){function r(){t.getVehicleView().then(function(t){var e=t.data.body;e&&0!=e.length?localStorage.setItem("vehicleView",JSON.stringify(e)):(e=JSON.parse(localStorage.getItem("vehicleView")),l=!1);var a=_.map(e,"_id"),n=[],o=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],r=!0;_.forEach(o,function(t,o){var i={};i.name=t;var l=_.indexOf(a,t);l>-1?(i.value=e[l].count,0!=i.value&&(r=!1)):i.value=0,n.push(i)}),console.log(n);var c={title:{text:"前一天消费趋势图（笔）",left:"3%",textStyle:{fontSize:30,fontWeight:"normal",color:"rgb(237,252,2)"}},tooltip:{trigger:"axis"},grid:{left:"3%",top:"20%",bottom:"40%",right:"35%"},xAxis:{type:"category",boundaryGap:!1,axisTick:{show:!1},axisLine:{lineStyle:{color:"rgb(8,88,123)"}},axisLabel:{textStyle:{color:"rgba(255,255,255,.6)",fontSize:22}},data:o},yAxis:{type:"value",boundaryGap:!1,axisLabel:{margin:15,textStyle:{color:"rgba(255,255,255,.6)",fontSize:22}},axisLine:{lineStyle:{color:"rgb(8,88,123)"}},splitLine:{lineStyle:{width:2,color:"rgb(8,88,123)"}}},series:[{name:"前一天消费(笔)",type:"line",stack:"总量",data:n,symbolSize:6,itemStyle:{normal:{color:"rgb(237,252,2)",shadowColor:"#FFF",shadowBlur:6}},lineStyle:{normal:{width:3,color:"rgb(237,252,2)"}}}]};l&&r||(l=!0,i.clear(),i.setOption(c))})}var i=echarts.init(n.find("#carData")[0]),l=!1;r(),e(function(){r()},864e5)}}}]),t.directive("wiservMapText",["dashboardService",function(t){return{restrict:"ACE",template:'<canvas id="myCanvas" ></canvas>',link:function(t,e,a){function n(t,e,a,n,o,r){var i,l=e.length;t.save(),t.translate(a,n),t.rotate(-1*r/2),t.rotate(-10*(r/l));for(var c=0;c<l;c++)t.rotate(r/l),t.save(),t.translate(0,-1*o),i=e[c],t.fillText(i,0,0),t.restore();t.restore()}setTimeout(function(){var t=e.parent()[0].clientHeight,a=e.parent()[0].offsetHeight;$(e.find("canvas")).attr("width",a),$(e.find("canvas")).attr("height",a);var o=4;t>700&&(o=5);var r=document.getElementById("myCanvas"),i=r.getContext("2d"),l=r.width/2+24,c=r.height/2+16,s=Math.PI/o,d=a/2;i.font="26px Calibri",i.textAlign="center",i.fillStyle="#FFF",i.strokeStyle="transparent",i.lineWidth=0,n(i,"社会化数据",l,c,d,s),i.arc(l,c,d-10,0,2*Math.PI,!1),i.stroke()},600)}}}]),t.directive("wiservMapTextDown",["dashboardService",function(t){return{restrict:"ACE",template:'<canvas id="downCanvas" ></canvas>',link:function(t,e,a){function n(t,e,a,n,o,r,i){var l,c=e.length;t.save(),t.translate(a,n),t.rotate(-1*r/1.5),t.rotate(i*(r/c));for(var s=0;s<c;s++)t.rotate(r/c),t.save(),t.translate(0,-1*o),l=e[s],t.fillText(l,0,0),t.restore();t.restore()}setTimeout(function(){var t=e.parent()[0].clientHeight,a=e.parent()[0].offsetHeight;$(e.find("canvas")).attr("width",a),$(e.find("canvas")).attr("height",a);var o=4,r=12;t>700&&(o=6,r=19);var i=document.getElementById("downCanvas"),l=i.getContext("2d"),c=i.width/2-20,s=i.height/2-30,d=Math.PI/o,u=a/2;l.font="26px Calibri",l.textAlign="center",l.fillStyle="#FFF",l.strokeStyle="transparent",l.lineWidth=0,n(l,"政务数据",c,s,u,d,r),l.arc(c,s,u-10,0,2*Math.PI,!1),l.stroke()},600)}}}]),t.directive("wiservMapChart",[function(){return{restrict:"ACE",template:"<svg ></svg>",link:function(t,e,a){function n(t,e){var a=(t-90)/180*Math.PI,n=e;return[-n*Math.cos(a),-n*Math.sin(a)]}setTimeout(function(){var t=e.parent()[0].clientHeight,a=e.parent()[0].offsetHeight;$(e.parent()[0]).css("width",a+"px"),$(e.parent()[0]).css("height",a+"px"),$(e.find("svg")[0]).attr("width",t),$(e.find("svg")[0]).attr("height",t);var o=d3.select(e.find("svg")[0]),r=+o.attr("width"),i=+o.attr("height"),l=o.append("g").attr("transform","translate("+r/2+","+i/2+")"),c=d3.stratify().parentId(function(t){return t.id.substring(0,t.id.lastIndexOf("."))}),s=[285,150];t>700&&(s=[285,230]);var d=d3.tree().size(s).separation(function(t,e){return t.parent==e.parent,1/t.depth});d3.csv("assets/file/flare.csv",function(t,e){if(t)throw t;var a=d(c(e)),o=(l.selectAll(".link").data(a.descendants().slice(1)).enter().append("path").attr("class","link").attr("d",function(t){return"M"+n(t.x,t.y)+"C"+n(t.x,(t.y+t.parent.y)/1.8)+" "+n(t.parent.x,(t.y+t.parent.y)/3)+" "+n(t.parent.x,t.parent.y/1.1)}),l.selectAll(".node").data(a.descendants()).enter().append("g").attr("class",function(t){return"node"+(t.children?" node--internal":" node--leaf")}).attr("transform",function(t){return t.children?"translate("+n(t.x,t.y/1.1)+")":"translate("+n(t.x,t.y)+")"}));o.append("circle").attr("r",9.5),o.append("text").attr("dy",".31em").attr("x",function(t){return t.x<180==!t.children?-12:12}).style("text-anchor",function(t){return t.x<180==!t.children?"end":"start"}).attr("transform",function(t){return"rotate("+(t.x<180?t.x-90:t.x+90)+")"}).text(function(t){return t.id.substring(t.id.lastIndexOf(".")+1)})})},600)}}}]),t.directive("wiservStandardSection",function(){return{restrict:"A",templateUrl:"partials/standard/view.html",replace:!0}}),t.directive("wiservCenterSection",function(){return{restrict:"A",templateUrl:"partials/center/view.html",replace:!0}}),t.directive("wiservDeptSection",function(){return{restrict:"A",templateUrl:"partials/dept/view.html",replace:!0}}),t.directive("wiservSupportSection",function(){return{restrict:"A",templateUrl:"partials/support/view.html",replace:!0}}),t.directive("wiservDatamapSection",function(){return{restrict:"A",templateUrl:"partials/datamap/view.html",replace:!0}}),t.directive("wiservIdcuseSection",function(){return{restrict:"A",templateUrl:"partials/idcuse/view.html",replace:!0}}),t.directive("wiservBigdataSection",function(){return{restrict:"A",templateUrl:"partials/bigdata/view.html",replace:!0}}),t.directive("wiservDashboard",["$location",function(t){return{restrict:"A",templateUrl:"partials/dashboard/part.html",replace:!0,link:function(e,a,n){var o=(screen.width,screen.height),r=t.path();r.indexOf("main")>-1&&$(".section").css({height:o/2+"px"})}}}]),t.directive("wiservImagePlay",["$location",function(t){return{restrict:"A",templateUrl:"partials/support/sub.html",replace:!0,link:function(t,e,a){e.slick({slidesToShow:4,slidesToScroll:1,autoplay:!0,autoplaySpeed:3e3})}}}]),t.directive("wiservImagePlaydown",["$location",function(t){return{restrict:"A",templateUrl:"partials/support/subdown.html",replace:!0,link:function(t,e,a){e.slick({slidesToShow:4,slidesToScroll:1,autoplay:!0,autoplaySpeed:3e3})}}}])}(),function(){var t=angular.module("app.dept",[]);t.$inject=["$location"],t.controller("deptController",["$scope","deptService","$rootScope","$interval","$timeout",function(t,e,a,n,o){function r(){i()}t.toggleMap=0,t.update_date=new Date,t.reqDone=!1,t.allow_toggle=!0,t.mouseEnter=function(){console.log("mouse enter...."),t.allow_toggle=!1},t.mouseLeave=function(){t.allow_toggle=!0},t.toggleDept=function(){if(t.allow_toggle){var e=angular.copy(t.toggleMap);t.toggleMap=(e+1)%3,1==t.toggleMap&&(_.forEach(t.deptAccessData,function(t){t.i_width="0%"}),o(function(){_.forEach(t.deptAccessData,function(e){e.i_width=e.dataNum/t.deptAccessMax*100+"%"}),$(".dept-access-rank").slick("slickGoTo",0)},1e3))}},t.deptToggleClick=function(){t.allow_toggle=!0,t.toggleDept()},n(function(){t.toggleDept()},3e4),n(function(){i(),t.update_date=new Date},36e5);var i=function(){e.getDataCountLast().then(function(e){t.dataCountLast=e.data.body}),e.getResourceCombing().then(function(e){t.ResourceCombing=e.data.body[0]}),e.getAccessDataNum().then(function(e){t.deptAccessData=e.data.body,t.deptAccessMax=_.max(_.map(t.deptAccessData,"dataNum"))+30,_.forEach(t.deptAccessData,function(e){e.i_width=e.dataNum/t.deptAccessMax*100+"%"}),o(function(){$(".dept-access-rank").slick({slidesToShow:8,slidesToScroll:1,autoplay:!0,autoplaySpeed:2500,vertical:!0,verticalSwiping:!0})},10)}),o(function(){t.reqDone=!0,$(".profile-right-wrap").slick({slidesToShow:2,slidesToScroll:1,autoplay:!0,autoplaySpeed:2500})},100)};r()}]),t.factory("deptService",["$http","URL",function(t,e){function a(){return t.get(e+"/depDataInfo/dataCountLast")}function n(){return t.get(e+"/combing/ResourceCombing")}function o(){return t.get(e+"/depDataInfo/accessDataNum")}function r(){return t.get("assets/file/depts_coord.json")}function i(){return t.get("assets/file/dept_contract.json")}return{getDataCountLast:a,getResourceCombing:n,getAccessDataNum:o,getDeptCoords:r,getDeptContract:i}}]),t.directive("wiservChartMigrate",["deptService",function(t){return{restrict:"ACE",template:"<div id='deptData' style='width:100%;height:100%'></div>",link:function(e,a,n){var o=echarts.init(a.find("#deptData")[0]);t.getDeptCoords().then(function(t){function e(t,e,a,n){var o=[];if(n)for(var r=0,i=e.length;r<i;r++)a!=e[r].name&&o.push({coords:[t[a],t[e[r].name]]});else for(var r=0,i=e.length;r<i;r++)a!=e[r].name&&("成都市政务中心"==e[r].name||"成都市气象局"==e[r].name||"成都市工商局"==e[r].name||("成都市政府部门"==e[r].name?o.push({coords:[t[e[r].name],t[a]],lineStyle:{normal:{color:"rgb(103,254,0)"}}}):o.push({coords:[t[e[r].name],t[a]]})));return o}function a(t,e,a){for(var n=[],o=0,r=e.length;o<r;o++){var i=e[o].name;a!=i&&("成都市政府部门"==i?n.push({name:i,value:t[i],symbolSize:16,itemStyle:{normal:{color:"rgb(103,254,0)"}},label:{normal:{position:[-150,-60],textStyle:{color:"#FFF",fontSize:24,fontWeight:100}}}}):"成都市政务中心"==i||"成都市气象局"==i||"成都市工商局"==i?n.push({name:i,value:t[i],symbolSize:.001,label:{normal:{position:d}}}):t[i][0]>91&&t[i][0]<119&&t[i][1]<21?n.push({name:i,value:t[i],symbolSize:6,label:{normal:{position:[-30,22]}},itemStyle:{normal:{color:"rgb(255,241,81)"}}}):t[i][0]<=91?n.push({name:i,value:t[i],symbolSize:6,label:{normal:{position:[-80,-5]}},itemStyle:{normal:{color:"rgb(238,141,9)"}}}):n.push({name:i,value:t[i],symbolSize:6}))}return n.push({name:a,value:t[a],symbolSize:16,label:{normal:{position:[-100,-60],textStyle:{color:"#FFF",fontSize:24,fontWeight:100}}},itemStyle:{normal:{color:"rgb(255,234,1)"}}}),n}var n=t.data.coords,r=t.data.data,i="circle",l=.8,c=["38%","45%"],s=15,d=[60,-5],u=screen.width;screen.height;u<1600&&(l=.6,c=["29%","35%"],s=14,d=[15,-8]);var p={backgroundColor:"transparent",title:{text:"",left:"5",top:"10px",itemStyle:{normal:{borderColor:"rgba(100,149,237,1)",borderWidth:.5,areaStyle:{color:"#1b1b1b"}}}},tooltip:{trigger:"item"},geo:{map:"china",show:!1,zoom:l,layoutCenter:c,layoutSize:"100%",left:"2%",label:{emphasis:{show:!1}},roam:!0,silent:!0,itemStyle:{normal:{areaColor:"transparent",borderColor:"#000"},emphasis:{areaColor:"#2a333d"}}},series:[{type:"lines",zlevel:2,silent:!0,effect:{show:!0,period:6,trailLength:.005,color:"rgba(255,255,255,.8)",symbol:i,symbolSize:4},lineStyle:{normal:{color:"#a6c84c",width:1,opacity:.4,curveness:.2,shadowColor:"rgb(255,241,81)",shadowBlur:10}},data:e(n,r,"崇州市数据共享交换平台",!1)},{type:"effectScatter",coordinateSystem:"geo",zlevel:2,silent:!0,rippleEffect:{period:4,scale:3,brushType:"stroke"},label:{normal:{show:!0,position:[24,-5],formatter:"{b}",textStyle:{fontSize:s,fontFamily:"yahei",fontWeight:100}}},symbolSize:4,itemStyle:{normal:{color:"rgb(2,255,29)",shadowBlur:35,shadowColor:"rgba(2,255,29,1)",opacity:.6}},data:a(n,r,"崇州市数据共享交换平台")}]};o.setOption(p)})}}}]),t.directive("wiservChartContract",["deptService",function(t){return{restrict:"ACE",template:"<div id='deptData' style='width:100%;height:100%'></div>",link:function(e,a,n){var o=echarts.init(a.find("#deptData")[0]);t.getDeptContract().then(function(t){function e(t,e,a,n){var o=[];if(n)for(var r=0,i=e.length;r<i;r++)a!=e[r].name&&o.push({coords:[t[a],t[e[r].name]]});else for(var r=0,i=e.length;r<i;r++)a!=e[r].name&&("成都医保数据"==e[r].name||"舆情数据"==e[r].name||"行政审批数据"==e[r].name?"行政审批数据"==e[r].name?o.push({coords:[t[a],t[e[r].name]],lineStyle:{normal:{curveness:.18}}}):"成都医保数据"==e[r].name?o.push({coords:[t[a],t[e[r].name]],lineStyle:{normal:{curveness:.3}}}):o.push({coords:[t[a],t[e[r].name]]}):o.push({coords:[t[e[r].name],t[a]]}));return o}function a(t,e,a){for(var n=[],o=0,r=e.length;o<r;o++){var i=e[o].name;a!=i&&("国家资源卫星数据"==i?n.push({name:i,value:t[i],symbol:"circle",symbolSize:14,label:{normal:{position:[-80,-100]}}}):"成都工商数据"==i?n.push({name:i,value:t[i],symbolSize:14,label:{normal:{align:"right",position:[-30,30],rich:{b:{align:"right"},c:{align:"right"}}}}}):"社会信用数据"==i?n.push({name:i,value:t[i],symbolSize:14,label:{normal:{align:"right",position:[-0,25]}}}):"行政审批数据"==i?n.push({name:i,value:t[i],symbolSize:14,label:{normal:{position:[-20,35]}}}):"知识产权数据"==i?n.push({name:i,value:t[i],symbolSize:14,label:{normal:{position:[40,-70]}}}):"成都医保数据"==i?n.push({name:i,value:t[i],symbolSize:14,label:{normal:{position:[25,-10]}}}):n.push({name:i,value:t[i],symbolSize:14,label:{normal:{position:[30,-30]}}}))}return n.push({name:a,value:t[a],symbol:"image://"+location.protocol+"//"+location.host+"/CZPortal/assets/images/sign.png",symbolSize:50,label:{normal:{position:[20,-80],rich:{a:{color:"#edfc02",fontSize:26}}}},itemStyle:{normal:{color:"rgb(255,234,1)"}}}),n}var n=t.data.coords,r=t.data.data,i="circle",l=.8,c=["38%","45%"],s=20,d=[60,-5],u=screen.width;screen.height;u<1600&&(l=.6,c=["29%","35%"],s=18,d=[15,-8]);var p={backgroundColor:"transparent",title:{text:"",left:"5",top:"10px",itemStyle:{normal:{borderColor:"rgba(100,149,237,1)",borderWidth:.5,areaStyle:{color:"#1b1b1b"}}}},tooltip:{trigger:"item"},geo:{map:"china",show:!1,zoom:l,layoutCenter:c,layoutSize:"100%",left:"2%",label:{emphasis:{show:!1}},roam:!0,silent:!0,itemStyle:{normal:{areaColor:"transparent",borderColor:"#000"},emphasis:{areaColor:"#2a333d"}}},series:[{type:"lines",zlevel:2,silent:!0,effect:{show:!1,period:6,trailLength:.005,color:"rgba(255,255,255,.8)",symbol:i,symbolSize:4},lineStyle:{normal:{color:"rgb(18,236,252)",width:2,opacity:1,curveness:.35,shadowColor:"rgb(18,236,252)",shadowBlur:10}},data:e(n,r,"崇州市数据共享交换平台",!1)},{type:"effectScatter",coordinateSystem:"geo",zlevel:2,silent:!0,rippleEffect:{period:10,scale:3,brushType:"stroke"},label:{normal:{show:!0,position:[24,-5],formatter:function(t){var e=t.name.split("\n");return e.length>1?e.length>2?"{a|"+e[0]+"}\n{b|"+e[1]+"}{c|"+e[2]+"}":"{a|"+e[0]+"}\n{b|"+e[1]+"}":"{a|"+e[0]+"}"},rich:{a:{color:"#3bbbf0",fontSize:26,lineHeight:40},b:{color:"#3bbbf0",fontSize:26,fontFamily:"digiFont",verticalAlign:"bottom",padding:[0,10,0,0]},c:{color:"#3bbbf0",fontSize:20,verticalAlign:"bottom"
}},textStyle:{color:"#3bbbf0",fontSize:20,fontFamily:"digiFont",fontWeight:100}}},symbolSize:4,itemStyle:{normal:{color:"rgb(18,236,252)",shadowBlur:35,shadowColor:"rgba(2,255,29,1)",opacity:1}},data:a(n,r,"崇州市数据共享交换平台")}]};o.setOption(p)})}}}])}(),function(){var t=angular.module("app.catalog",[]);t.controller("catalogController",["$scope","catalogService","$rootScope","$interval","$timeout",function(t,e,a,n,o){var r={x:530,y:670,radius:320,radius_inner:310},i={normal:"rgb(31,234,193)",num_bg:"rgba(50,193,253,.23)",num:"#09a1df",num_active_bg:"rgb(51,178,127)",num_active:"#FFF"},l={normal:"rgb(9,161,223)",num_bg:"rgba(50,193,253,.23)",num:"rgb(50,193,253)",num_active_bg:"rgb(62,136,236)",num_active:"#FFF"};e.getDeptCatalog().then(function(a){if(t.data1=["市安监局","市财政局","市城管局","市地税局","市发改局","市法制办","市公安局","市规划局","市国税局","市国土局","市环保局","市交通局","市教育局","市经信局","市民政局","市农发局","市气象局","市人社局","市商投局","市审计局","市市场监管","市水务局","市司法局","市统计局","市卫计局","市文旅局","市政务中心","市住建局","市综合执法","崇信大数据","市供电分公司"],t.data2=["崇阳街道","羊马镇","崇平镇","梓潼镇","廖家镇","三江镇","江源镇","大划镇","王场镇","白头镇","道明镇","济协乡","隆兴镇","桤泉镇","集贤乡","燎原乡","元通镇","观胜镇","锦江乡","公议乡","怀远镇","街子镇","三郎镇","文井江镇","鸡冠山乡"],t.data_number1=["256","301","145","344","53","256","301","145","344","53","301","145","344","53","256","53","256","301","145","344","53","256","53","256","301","145","344","145","344","53","45"],t.data_number2=["301","145","344","53","256","53","256","301","145","344","53","256","53","256","301","145","344","145","344","53","53","256","301","145","344"],t.data_code1=[],t.data_code2=[],a&&a.data){var o=a.data.body,c=_.groupBy(o,function(t){return t.dept_type}),s=c.C,d=c.Z,u=_.union(s,d);t.data1=_.map(u,"dept_short_name"),t.data2=_.map(c.X,"dept_short_name"),t.data_number1=_.map(u,"num"),t.data_number2=_.map(c.X,"num"),t.data_code1=_.map(u,"dept_code"),t.data_code2=_.map(c.X,"dept_code"),t.DeptCataData={},t.TownCataData={};var p=t.data1.length,m=t.data2.length,g=t.data1.length+t.data2.length,h=16,b=13,f=null;setTimeout(function(){function a(e){1==e&&(t.data1.splice(0,0,t.data1[p-1]),t.data1.splice(p,1),t.data_number1.splice(0,0,t.data_number1[p-1]),t.data_number1.splice(p,1),t.data_code1.splice(0,0,t.data_code1[p-1]),t.data_code1.splice(p,1)),2==e&&(t.data2.splice(0,0,t.data2[m-1]),t.data2.splice(m,1),t.data_number2.splice(0,0,t.data_number2[m-1]),t.data_number2.splice(m,1),t.data_code2.splice(0,0,t.data_code2[m-1]),t.data_code2.splice(m,1))}function o(t,e,n,o,c){var s=r.radius_inner,d=r.x,u=r.y,p=3e3,m=p,v=o,y=v+n;!function(){fabric.util.animate({startValue:v,endValue:y,duration:m,easing:fabric.util.ease.easeOutBounce,onChange:function(r){var c=r;r=fabric.util.degreesToRadians(r);var p=d+s*Math.cos(r),m=u+s*Math.sin(r);t.set({left:p,top:m,angle:o+n}).setCoords(),h==e&&1==t.g_type&&(t.dept_data.set({fill:i.num_active}),t.bg_rect.set({fill:i.num_active_bg}),t.dept_number.set({fill:i.num_active})),b==e&&2==t.g_type&&(t.dept_data.set({fill:l.num_active}),t.bg_rect.set({fill:l.num_active_bg}),t.dept_number.set({fill:l.num_active})),"崇信大数据"!=t.dept_data.text&&"市供电分公司"!=t.dept_data.text||t.dept_data.set({fill:"#c8eb24"}),e===g-1&&(c==y&&(1==t.g_type&&a(1),2==t.g_type&&a(2)),f.renderAll())},onComplete:function(){}})}()}function c(t,e,a,n,o,c,s,d,u){var p=i.num_bg,m=i.normal,g=i.num;2==t&&(m=l.normal),""==a&&(p="transparent"),"崇信大数据"!=n&&"市供电分公司"!=n||(m="#c8eb24");var h=new fabric.Rect({width:42,height:26,fill:p,originX:"left",originY:"left",rx:6,ry:6,centeredRotation:!0}),b=new fabric.Text(""+a,{fontSize:20,fill:g,originX:c,originY:"center",centeredRotation:!0,left:3,angle:s}),f=new fabric.Group([h,b],{centeredRotation:!0,selectable:!1,hasControls:!1,hoverCursor:"pointer",left:145}),v=new fabric.Text(n,{centeredRotation:!0,fontSize:23,dept_code:o,fill:m,originX:c,originY:"center",angle:s}),y=new fabric.Group([v,f],{centeredRotation:!0,subtargets:!1,selectable:!1,hasControls:!1,hoverCursor:"pointer",left:r.x+Math.round(r.radius_inner*Math.cos(u)),top:r.y+Math.round(r.radius_inner*Math.sin(u)),angle:d});return y.dept_data=v,y.dept_number=b,y.bg_rect=h,y.g_type=t,y.g_index=e,y}function s(a,n,o){1==a?t.DeptCataData.deptName=o:t.TownCataData.deptName=o,e.getDataByDept({dept_code:n}).then(function(e){if(e&&e.data&&e.data.body){var n=e.data.body[0].num;1==a?t.DeptCataData.catalog=n:t.TownCataData.catalog=n}}),e.getDataItemByDept({dept_code:n}).then(function(e){if(e&&e.data&&e.data.body){var n=e.data.body[0].num;1==a?t.DeptCataData.dataItem=n:t.TownCataData.dataItem=n}}),e.getSystemByDept({dept_code:n}).then(function(e){if(e&&e.data&&e.data.body){var n=e.data.body[0].num;1==a?t.DeptCataData.system=n:t.TownCataData.system=n}}),e.getResByDept({dept_code:n}).then(function(e){if(e&&e.data&&e.data.body){var n=e.data.body[0].num;1==a?t.DeptCataData.resource=n:t.TownCataData.resource=n}})}function d(){e.getDataCountLast().then(function(e){t.dataCountLast=e.data.body}),e.getInvokeNum().then(function(e){t.invokeNum=e.data.body[0].num})}function u(){t.draw(),s(1,t.data_code1[h],t.data1[h]),s(2,t.data_code2[b],t.data2[b]),d()}f=this.__canvas=new fabric.Canvas("mycanvas");for(var v=360/g,y=0;y<g;y++)t.data1[y]||(t.data1.push(""),t.data_number1.push(""),t.data_code1.push("")),t.data2[y]||(t.data2.push(""),t.data_number2.push(""),t.data_code2.push(""));t.draw=function(){f.clear();for(var e=g-1;e>=0;e--){var a=(e+10.5)*v,n=(e+10.5)*v*Math.PI/180,l=(e-14.5)*v,s=(e-14.5)*v*Math.PI/180,d=0,u=2,h="left",b="left";new fabric.Rect({width:50,height:26,centeredRotation:!0,fill:i.num_bg,originX:"center",originY:"center",rx:6,ry:6,left:r.x+Math.round(r.radius_inner*Math.cos(n)),top:r.y+Math.round(r.radius_inner*Math.sin(n)),angle:a});Math.cos(n)>0||(d=180,h="right");var y=c(1,e,t.data_number1[e],t.data1[e],t.data_code1[e],h,d,a,n);f.add(y),o(y,e,v,a,p);var S=c(2,e,t.data_number2[e],t.data2[e],t.data_code2[e],b,u,l,s);f.add(S),o(S,e,v,l,m)}},u(),t.timer1=n(function(){t.draw(),s(1,t.data_code1[h],t.data1[h]),s(2,t.data_code2[b],t.data2[b])},5e3),f.on("mouse:over",function(e){var a=e.target;console.log(a),(a&&a.dept_data||a&&a.dept_number)&&(n.cancel(t.timer1),t.timer1=null,1==a.g_type&&""!=a.dept_data.text&&("崇信大数据"!=a.dept_data.text&&"市供电分公司"!=a.dept_data.text&&a.dept_data.set({fill:i.num_active}),a.bg_rect.set({fill:i.num_active_bg}),a.dept_number.set({fill:i.num_active})),2==a.g_type&&""!=a.dept_data.text&&(a.dept_data.set({fill:l.num_active}),a.bg_rect.set({fill:l.num_active_bg}),a.dept_number.set({fill:l.num_active}))),f.renderAll()}),f.on("mouse:out",function(e){var a=e.target;(a&&a.dept_data||a&&a.dept_number)&&(1==a.g_type&&""!=a.dept_data.text&&h!=a.g_index&&("崇信大数据"!=a.dept_data.text&&"市供电分公司"!=a.dept_data.text&&a.dept_data.set({fill:i.normal}),a.dept_number.set({fill:i.num}),a.bg_rect.set({fill:i.num_bg})),2==a.g_type&&""!=a.dept_data.text&&b!=a.g_index&&(a.dept_data.set({fill:l.normal}),a.dept_number.set({fill:l.num}),a.bg_rect.set({fill:l.num_bg})),n.cancel(t.timer1),t.timer1=n(function(){t.draw(),s(1,t.data_code1[h],t.data1[h]),s(2,t.data_code2[b],t.data2[b])},5e3)),f.renderAll()}),f.on("mouse:down",function(t){var e=t.target;(e&&e.dept_data||e&&e.dept_number)&&""!=e.dept_data.text&&s(e.g_type,e.dept_data.dept_code,e.dept_data.text)})},500)}});var c=[],s=0;setTimeout(function(){e.getThemeData().then(function(t){function e(t){fabric.util.animateColor("rgb(9,161,223)","rgb(200,235,36,1)",1500,{onChange:function(e){t.text_label.set("fill",e),t.text_number.set("fill",e),n.renderAll.bind(n)}}),t.text_label.animate({top:t.text_label.top-18},{duration:1500,onChange:n.renderAll.bind(n),onComplete:function(){},easing:function(t,e,a,n){return a*t/n+e}}),t.text_number.animate({top:t.text_number.top-15,opacity:1},{duration:1500,onChange:n.renderAll.bind(n),onComplete:function(){setTimeout(function(){t.text_label.animate({top:t.text_label.top+18},{duration:1500,onChange:n.renderAll.bind(n),easing:function(t,e,a,n){return a*t/n+e}}),t.text_number.animate({top:t.text_number.top+15,opacity:0},{duration:1500,onChange:n.renderAll.bind(n),easing:function(t,e,a,n){return a*t/n+e}}),fabric.util.animateColor("rgb(200,235,36,1)","rgb(9,161,223)",1500,{onChange:function(e){t.text_label.set("fill",e),t.text_number.set("fill",e)}}),n.renderAll()},1500)},easing:function(t,e,a,n){return a*t/n+e}})}function a(t,e,a,n,o,r,i,l){var c=new fabric.Circle({left:e,top:a,radius:t,fill:"#FFF"});c.setGradient("fill",{type:"radial",x1:t,y1:t,x2:t,y2:t,r1:c.width/2,r2:0,colorStops:{0:"rgb(6,88,127)",.05:"rgba(16,52,75,.8)",1:"rgba(16,52,75,1)"}});var s=new fabric.Text(n,{textAlign:"center",left:i,top:l,fill:"rgb(9,161,223)",fontSize:r+8,opacity:1}),o=new fabric.Text(o,{left:s.left-5,top:s.top+45+r,fill:"transparent",fontSize:r,opacity:0}),d=new fabric.Group([c,s,o],{centeredRotation:!0,selectable:!1,hasControls:!1,hoverCursor:"pointer",originX:"left"});return d.text_label=s,d.text_number=o,d}var n=new fabric.Canvas("bubblecanvas"),o=t.data.body,r="";_.forEach(o,function(t){t.subjectName.length>11?(r=t.subjectName.substring(0,6),t.subjectName=r+"\n"+t.subjectName.substring(6,15)):(r=t.subjectName.substring(0,4),t.subjectName=r+"\n"+t.subjectName.substring(4,10))}),console.log(o);var i=a(80,50,30,o[0].subjectName," 专题个数："+o[0].num,14,86,83),l=a(75,240,100,o[1].subjectName,"  专题个数："+o[1].num,13,275,153),d=a(103,410,0,o[2].subjectName,"   专题个数："+o[2].num,18,452,73),u=a(64,120,260,o[3].subjectName,"  专题个数："+o[3].num,10,150,305),p=a(86,320,260,o[4].subjectName," 专题个数："+o[4].num,16,358,315),m=a(72,540,200,o[5].subjectName,"        专题个数："+o[5].num,10,552,250);c.push(i),c.push(l),c.push(d),c.push(u),c.push(p),c.push(m),n.add(i),n.add(l),n.add(d),n.add(u),n.add(p),n.add(m),n.on("mouse:over",function(t){}),n.on("mouse:out",function(t){}),n.on("mouse:down",function(t){}),setInterval(function(){e(c[s%6]),s++},4500)})},500)}]),t.factory("catalogService",["$http","URL",function(t,e){function a(){return t.get(e+"/combing/deptInfo")}function n(a){return t.get(e+"/combing/dirNum",{params:a})}function o(a){return t.get(e+"/combing/itemNum",{params:a})}function r(a){return t.get(e+"/combing/systemNum",{params:a})}function i(a){return t.get(e+"/depDataInfo/dataSetNum",{params:a})}function l(){return t.get(e+"/depDataInfo/dataCountLast")}function c(){return t.get(e+"/depDataInfo/subjectInfo")}function s(){return t.get(e+"/depDataInfo/themeInfo")}function d(){return t.get(e+"/depDataInfo/invokeNumByApp")}return{getDeptCatalog:a,getDataByDept:n,getDataItemByDept:o,getSystemByDept:r,getResByDept:i,getDataCountLast:l,getThemeData:c,getThemeRank:s,getInvokeNum:d}}]),t.directive("wiservThemeRank",["catalogService",function(t){return{restrict:"ACE",template:"<div id='themeRank' style='width:700px;height:500px'></div>",link:function(e,a,n){var o=echarts.init(a.find("#themeRank")[0]);t.getThemeRank().then(function(t){var e="image://data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAlCAYAAACONvPuAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpjMzk2MzljYy1hMzRkLTU3NDktODM4Yy05Y2U4YjYxOGYwNmQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QTJEQzNBQ0ZFOUUwMTFFN0I0ODhBMUJCODhGRTI5MTEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTJEQzNBQ0VFOUUwMTFFN0I0ODhBMUJCODhGRTI5MTEiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ODc1NWY5ZjctZTA1Zi0yYzQ5LThmNTAtODQ0NjVkMGIzMWRhIiBzdFJlZjpkb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6YTUyODk2ODgtYTBhYy0xMWU2LWI3OWUtYTEyZjM3MGIwZTM1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+GjlvQQAAAGpJREFUeNpi5Fx4n5WBgUEGiMWA+D8QfwHiOyA2E5AQhUqAACMQ8wKxJIgDkhRnwAQSQMzFxIAbsOKTZBiVHFaS//BJ/h8NIdpK/sYn+RAUPWjiH4D4K0jyBxA/AuJfQPwXiL9DNfwHCDAAj8ITzGkC6NsAAAAASUVORK5CYII=",a="image://data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAlCAYAAACONvPuAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpjMzk2MzljYy1hMzRkLTU3NDktODM4Yy05Y2U4YjYxOGYwNmQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NURGNjAzQUZFOUVBMTFFN0I1N0FFMDc2OTQ1RjMzOTAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NURGNjAzQUVFOUVBMTFFN0I1N0FFMDc2OTQ1RjMzOTAiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ODc1NWY5ZjctZTA1Zi0yYzQ5LThmNTAtODQ0NjVkMGIzMWRhIiBzdFJlZjpkb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6YTUyODk2ODgtYTBhYy0xMWU2LWI3OWUtYTEyZjM3MGIwZTM1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+PWpIUgAAAG5JREFUeNpi5Fx4n5WBgUEaiE8CsRgQfwbiVCBexwQkeIF4M1SCAcqfCcSKIEkvINZhQAX8QDwNJMnIgB2IMzHgAaOSo5KjklSSfArE/7HI/QVJHgbiqegSQFwBM7YCiHcD8Qsg/gnEBUC8FyDAABIrEZcHojQvAAAAAElFTkSuQmCC",n=_.sortBy(t.data.body,function(t){return-t.num});console.log(n);var r=_.map(n,"themeName"),i=_.map(n,"num"),l=_.max(i)+10,c=r.length,s=angular.copy(r),d=angular.copy(i);s.splice(6,r.length-6),d.splice(6,d.length-6);var u={tooltip:{},xAxis:{max:l,splitLine:{show:!1},axisTick:{show:!1},axisLine:{show:!1}},yAxis:{data:s,inverse:!0,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{margin:25,textStyle:{color:"#09a1df",fontSize:22}}},grid:{top:-15,left:160,right:160,bottom:80},series:[{type:"pictorialBar",symbol:a,symbolRepeat:"fixed",symbolMargin:"50%",symbolClip:!0,symbolSize:[5,32],symbolBoundingData:l,data:d,z:10},{type:"pictorialBar",label:{normal:{show:!0,formatter:function(t){return t.value},position:"right",offset:[20,0],textStyle:{color:"#c8cbd7",fontSize:22,align:"left",fontFamily:"digiFont"}}},animationDuration:0,symbolRepeat:"fixed",symbolMargin:"50%",symbol:e,symbolSize:[5,32],symbolBoundingData:l,data:d,z:5}]};o.setOption(u);var p=0;setInterval(function(){for(var t=u.series[0].data,e=(t.splice(0,1),u.yAxis.data.splice(0,1),0);e<1;e++)t.push(i[(e+1*p+6)%c]),u.yAxis.data.push(r[(e+1*p+6)%c]);p++,o.setOption(u)},3e3)})}}}])}();