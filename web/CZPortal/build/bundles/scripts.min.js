"use strict";!function(){function e(e,t,a){function n(e,t){return{request:function(e){var a=screen.width,n=screen.height,o=t.path();return setTimeout(function(){o.indexOf("main")>-1&&($(".section").css({height:n/2+"px",width:a/2+"px"}),$(".section-main").css({height:n+"px",width:a+"px"}),$(".section-center").css({height:n/2+"px",width:a+"px"}),$(".section h1").css({"line-height":"2rem"}),$(".chart-idc-use").css({height:"66%"}),$(".idcuse-desc p").css({"font-size":"0.9rem"}),$(".idcuse-desc p strong").css({"font-size":"1rem"})),(o.indexOf("dept")>-1||o.indexOf("standard")>-1||o.indexOf("support")>-1||o.indexOf("datamap")>-1||o.indexOf("idcuse")>-1||o.indexOf("bigdata")>-1)&&($(".section").css({height:n+"px",width:a+"px"}),$("body").css({overflow:"hidden"})),o.indexOf("dashboard")>-1&&($("html").css({"font-size":"16px"}),$("#dashboard").css({height:n+"px",width:a+"px"}),$(".section").css({height:n/2+"px",width:a/4+"px"}),$(".section-center").css({height:n/2+"px",width:a/2+"px"}),$(".section.city-datamap").css({position:"absolute",top:n/2+"px",left:a/4+"px"}),$(".section.idcuse").css({position:"absolute",top:n/2+"px",right:a/4+"px"}),$(".section.bigdata").css({position:"absolute",top:n/2+"px",left:0}),$(".section.standard").css({position:"absolute",top:n/2+"px",right:0}))},500),e},response:function(t){return e.when(t,function(e){}),t}}}t.otherwise("/dashboard"),e.state("dashboard",{url:"/dashboard",templateUrl:"partials/dashboard/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("standard",{url:"/standard",templateUrl:"partials/standard/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("center",{url:"/center",templateUrl:"partials/center/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("main",{url:"/main",templateUrl:"partials/main/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("bigdata",{url:"/bigdata",templateUrl:"partials/bigdata/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("support",{url:"/support",templateUrl:"partials/support/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("datamap",{url:"/datamap",templateUrl:"partials/datamap/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("idcuse",{url:"/idcuse",templateUrl:"partials/idcuse/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("dept",{url:"/dept",templateUrl:"partials/dept/view.html",controller:"deptController",controllerAs:"dept"}),a.interceptors.push(n),n.$inject=["$q","$location"]}angular.module("app",["ngAnimate","ui.router","common.http","app.dashboard","app.dept","app.catalog"]).config(e),e.$inject=["$stateProvider","$urlRouterProvider","$httpProvider"]}(),function(){var e=angular.module("common.http",[]);e.constant("URL",location.protocol+"//"+location.host+"/BigScreenShow/data"),e.factory("validate",[function(){return function(e,t){var a=function(t){return e&&e.head&&e.head.status===t};switch(t){case 200:return a(t);case 201:return a(t);case 202:return a(t);case 400:return a(t);case 404:return a(t);case 405:return a(t);case 415:return a(t);case 500:return a(t)}}}])}(),function(){var e=angular.module("app.dashboard",[]);e.$inject=["$location"],e.controller("dashboardController",["$scope","dashboardService","$rootScope","$interval","$timeout",function(e,t,a,n,o){function r(){e.CivilServant={};var t=Number(localStorage.getItem("all")),a=Number(localStorage.getItem("careerPersonnel")),n=Number(localStorage.getItem("onTheJob")),o=Number(localStorage.getItem("beLate")),r=Number(localStorage.getItem("leaveEarly")),i=Number(localStorage.getItem("daily")),l=Number(localStorage.getItem("weekly")),c=Number(localStorage.getItem("quarter"));t?e.CivilServant.all=t:(e.CivilServant.all=Math.round(99*Math.random()+3042),localStorage.setItem("all",e.CivilServant.all)),a?e.CivilServant.careerPersonnel=a:(e.CivilServant.careerPersonnel=1e3,localStorage.setItem("careerPersonnel",e.CivilServant.careerPersonnel)),n?e.CivilServant.onTheJob=n:(e.CivilServant.onTheJob=0+e.CivilServant.all+e.CivilServant.careerPersonnel-Math.round(20*Math.random()+30),localStorage.setItem("onTheJob",e.CivilServant.onTheJob)),o?e.CivilServant.beLate=o:(e.CivilServant.beLate=Math.round(20*Math.random()+30),localStorage.setItem("beLate",e.CivilServant.beLate)),r?e.CivilServant.leaveEarly=r:(e.CivilServant.leaveEarly=Math.round(20*Math.random()+30),localStorage.setItem("leaveEarly",e.CivilServant.leaveEarly)),i?e.CivilServant.daily=i:(e.CivilServant.daily=0+e.CivilServant.all+e.CivilServant.careerPersonnel-Math.round(20*Math.random()+30),localStorage.setItem("daily",e.CivilServant.daily)),l?e.CivilServant.weekly=l:(e.CivilServant.weekly=0+e.CivilServant.all+e.CivilServant.careerPersonnel-Math.round(20*Math.random()+30),localStorage.setItem("weekly",e.CivilServant.weekly)),c?e.CivilServant.quarter=c:(e.CivilServant.quarter=0+e.CivilServant.all+e.CivilServant.careerPersonnel-Math.round(200*Math.random()+500),localStorage.setItem("quarter",e.CivilServant.quarter))}var i=this;a.change_flag=!1,e.update_day_date=new Date,e.update_date=new Date,e.current_tab=1,o(function(){$("#menu-scroll").slick({infinite:!0,slidesToShow:5,slidesToScroll:1,autoplay:!0,autoplaySpeed:3e4,vertical:!0,verticalSwiping:!0})},1e3),n(function(){e.allow_main_toggle&&(e.catalogShow?e.catalogShow=!1:e.catalogShow=!0)},18e4),e.allow_main_toggle=!0,e.mainViewTitle="切换视图",e.mainToggleClick=function(){e.allow_main_toggle=!0,e.toggleMain()},e.mouseMainEnter=function(){e.allow_main_toggle=!1},e.mouseMainLeave=function(){e.allow_main_toggle=!0},e.catalogShow=!0,e.toggleMain=function(){e.allow_main_toggle&&(e.catalogShow?e.catalogShow=!1:e.catalogShow=!0)},$("#menu-scroll").on("beforeChange",function(t,a,n,r){e.current_tab=r+1,console.log(e.current_tab),5==e.current_tab&&o(function(){$(".weather-scroll").slick({infinite:!0,slidesToShow:2,slidesToScroll:1,cssEase:"linear",autoplay:!0,centerMode:!0,autoplaySpeed:0,speed:7e3,vertical:!0,verticalSwiping:!0})},500)}),e.toggle=function(t){e.current_tab=t,$("#menu-scroll").slick("slickGoTo",t-1)};var l=function(){t.getVehicle().then(function(t){var a=t.data.body[0];a&&void 0!=a.yesterday&&void 0!=a.week&&void 0!=a.month&&void 0!=a.all?(localStorage.setItem("veh_yesterday",a.yesterday),localStorage.setItem("veh_week",a.week),localStorage.setItem("veh_month",a.month),localStorage.setItem("veh_all",a.all)):(a={},a.yesterday=localStorage.getItem("veh_yesterday"),a.week=localStorage.getItem("veh_week"),a.month=localStorage.getItem("veh_month"),a.all=localStorage.getItem("veh_all")),e.Vehicle=a})},c=function(){t.getCivilServant().then(function(e){r()})};n(function(){e.CivilServant.onTheJob=e.CivilServant.all+e.CivilServant.careerPersonnel-Math.round(20*Math.random()+30),localStorage.setItem("onTheJob",e.CivilServant.onTheJob),e.CivilServant.beLate=Math.round(20*Math.random()+30),localStorage.setItem("beLate",e.CivilServant.beLate),e.CivilServant.leaveEarly=Math.round(20*Math.random()+30),localStorage.setItem("leaveEarly",e.CivilServant.leaveEarly),e.CivilServant.daily=e.CivilServant.all+e.CivilServant.careerPersonnel-Math.round(20*Math.random()+30),localStorage.setItem("daily",e.CivilServant.daily)},864e5),n(function(){e.CivilServant.weekly=e.CivilServant.all+e.CivilServant.careerPersonnel-Math.round(20*Math.random()+30),localStorage.setItem("weekly",e.CivilServant.weekly)},6048e5);var s=function(){t.getGovernmentApprovalSystem().then(function(t){e.GovernmentApprovalSystem=t.data.body[0]})},d=function(){t.getMeteorologicalObservationStation().then(function(t){e.MeteorologicalObservationStation=t.data.body[0]}),t.getMos_maxTemperature().then(function(t){var a=t.data.body[0];a&&void 0!=a.zgqw?(localStorage.setItem("zgqw",a.zgqw),localStorage.setItem("zgqw_zm",a.zm),localStorage.setItem("zgqw_rksj",a.rksj)):(a={},a.zgqw=localStorage.getItem("zgqw"),a.zm=localStorage.getItem("zgqw_zm"),a.rksj=localStorage.getItem("zgqw_rksj")),e.Mos_maxTemperature=a}),t.getMos_minTemperature().then(function(t){var a=t.data.body[0];a&&void 0!=a.zdqw?(localStorage.setItem("zdqw",a.zdqw),localStorage.setItem("zdqw_zm",a.zm),localStorage.setItem("zdqw_rksj",a.rksj)):(a={},a.zdqw=localStorage.getItem("zdqw"),a.zm=localStorage.getItem("zdqw_zm"),a.rksj=localStorage.getItem("zdqw_rksj")),e.Mos_minTemperature=a}),t.getMos_maxRainfall().then(function(t){var a=t.data.body[0];a&&void 0!=a.yxsyl?(localStorage.setItem("yxsyl",a.yxsyl),localStorage.setItem("yxsyl_zm",a.zm),localStorage.setItem("yxsyl_rksj",a.rksj)):(a={},a.yxsyl=localStorage.getItem("yxsyl"),a.zm=localStorage.getItem("yxsyl_zm"),a.rksj=localStorage.getItem("yxsyl_rksj")),e.Mos_maxRainfall=a})},u=function(){e.hide_weather=!1,t.getWeatherForecast().then(function(t){t&&t.data&&t.data.body&&t.data.body[0]?(e.hide_weather=!1,e.WeatherForecast=t.data.body[0]):e.hide_weather=!0}),e.hide_disaster=!1,t.getDisasterWarning().then(function(t){e.DisasterWarning=t.data.body,e.DisasterWarning&&e.DisasterWarning.length>0||(e.hide_disaster=!0)})};e.getTimingData=function(){t.getDisasterWarning().then(function(t){e.DisasterWarning=t.data.body,e.DisasterWarning&&e.DisasterWarning.length>0?(e.hide_disaster=!1,o(function(){$(".weather-scroll").slick({slidesToShow:2,slidesToScroll:1,cssEase:"linear",autoplay:!0,centerMode:!0,autoplaySpeed:0,speed:7e3,vertical:!0,verticalSwiping:!0})},300)):e.hide_disaster=!0})},e.getWeatherData=function(){t.getWeatherForecast().then(function(t){t&&t.data&&t.data.body&&t.data.body[0]?(e.hide_weather=!1,e.WeatherForecast=t.data.body[0]):e.hide_weather=!0})};var m=function(){t.getCreditWebOne().then(function(t){e.CreditWebOne=t.data.body[0]}),t.getCreditWebTwo().then(function(t){e.CreditWebTwo=t.data.body[0]}),t.getCreditWebThree().then(function(t){e.CreditWebThree=t.data.body[0]}),e.entries=[{label:"社保登记",color:"#01ccd1"},{label:"税务登记"},{label:"司法行政登记",color:"#01ccd1"},{label:"事业单位登记"},{label:"企业注册人"},{label:"市场主体退出（注销）"},{label:"市场主体退出（吊销）",color:"#01ccd1"},{label:"事业单位年报"},{label:"机关群团登记"},{label:"诚信企业评价",color:"#01ccd1"},{label:"批评谴责",color:"#01ccd1"},{label:"失信被执行人"},{label:"水电欠费信息"},{label:"司法执行"},{label:"司法判决"},{label:"产品质量监督抽查"},{label:"拖欠公积金"},{label:"表彰奖励"},{label:"中小企业信用等级"},{label:"食品生产经营企业监管等级",color:"#01ccd1"},{label:"纳税信用评级"},{label:"其它行政处理措施",color:"#01ccd1"},{label:"重大税收违法"},{label:"行政奖励"},{label:"行政强制措施"},{label:"工商局行政处罚",color:"#01ccd1"},{label:"行政处罚"},{label:"民政登记",color:"#01ccd1"},{label:"商标"},{label:"专利"},{label:"动产抵押"},{label:"对外贸易经营者备案登记",color:"#01ccd1"},{label:"绿色食品"},{label:"农产品地理标志"},{label:"无公害农产品"},{label:"行业资质资格",color:"#01ccd1"},{label:"行政许可",color:"#01ccd1"},{label:"市场主体退出",color:"#01ccd1"},{label:"股权出质"},{label:"消费者投诉站"},{label:"协会成员单位",color:"#01ccd1"},{label:"机构代码证发放"},{label:"公积金缴存登记"},{label:"市场主体"}];({entries:e.entries,width:900,height:400,radius:"40%",radiusMin:175,bgDraw:!0,bgColor:"transparent",opacityOver:1,opacityOut:.05,opacitySpeed:10,fov:1e3,speed:.2,fontFamily:"Oswald, Arial, sans-serif",fontSize:"18",fontColor:"#fff",fontWeight:"normal",fontStyle:"normal",fontStretch:"normal",fontToUpperCase:!0});o(function(){var e={textFont:"Arial, Helvetica, sans-serif",maxSpeed:.05,minSpeed:.01,textColour:null,textHeight:12,outlineMethod:"colour",fadeIn:800,outlineColour:"#41b1c3",outlineOffset:0,depth:.97,minBrightness:.2,wheelZoom:!1,reverse:!0,shadowBlur:2,shuffleTags:!0,shadowOffset:[1,1],stretchX:1.6,initial:[0,.1],clickToFront:600,maxSpeed:.01,outlineDashSpeed:.5},t=(new Date).getTime()/360;e.initial[0]=.18*Math.cos(t),e.initial[1]=.18*Math.sin(t),$("#myCanvas").tagcanvas(e,"tags")||$("#myCanvasContainer").hide()},600)},g=function(){t.getIndustrialPolicy().then(function(t){e.IndustrialPolicy=t.data.body,_.forEach(e.IndustrialPolicy,function(e,t){t%3==0?e.itemStyle="item-up":t%3==1?e.itemStyle="item-center":e.itemStyle="item-down"}),o(function(){$("#pro-list").slick({slidesToShow:3,slidesToScroll:1,autoplay:!0,autoplaySpeed:3e3,vertical:!0,verticalSwiping:!0})},500)})},p=function(){t.getDeptDataQuantity().then(function(e){var t=e.data.body[0];t&&(i.deptData=t)}),t.getDataCount().then(function(e){var t=e.data.body[0];t&&(i.deptDataCount=t)}),l(),c(),s(),d(),u(),m(),g()};e.catalogShow||p(),e.toggleDept=function(){if(e.allow_toggle){var t=angular.copy(e.toggleMap);e.toggleMap=(t+1)%3,1==e.toggleMap&&(_.forEach(e.deptAccessData,function(e){e.i_width="0%"}),o(function(){_.forEach(e.deptAccessData,function(t){t.i_width=t.dataNum/e.deptAccessMax*100+"%"}),$(".dept-access-rank").slick("slickGoTo",0)},100))}},e.toggleBigdata=function(){e.allow_ipc_toggle&&(e.toggleIPC?e.toggleIPC=!1:e.toggleIPC=!0)},e.bigdataToggleClick=function(){e.allow_ipc_toggle=!0,e.toggleBigdata()},e.toggleIPC=!1,e.deptViewTitle="切换视图",n(function(){e.toggleBigdata()},3e4),e.allow_toggle=!0,e.mouseEnter=function(){console.log("mouse enter...."),e.allow_toggle=!1},e.mouseLeave=function(){console.log("mouse leave...."),e.allow_toggle=!0},e.allow_ipc_toggle=!0,e.mouseIPCEnter=function(){e.allow_ipc_toggle=!1},e.mouseIPCLeave=function(){e.allow_ipc_toggle=!0},n(function(){e.update_day_date=new Date},864e5),n(function(){u()},9e5),n(function(){d(),l(),c(),s(),m(),g(),e.update_date=new Date},36e5),e.changeRoute=function(){t.getStatus().then(function(e){var a=e.data,n="";n=1==a?"":1,t.setStatus(n).then(function(){})})}}]),e.factory("dashboardService",["$http","URL",function(e,t){function a(){return e.get(t+"/depDataInfo/quantity")}function n(){return e.get(t+"/status/get")}function o(){return e.get(t+"/serverMonitor/detail")}function r(){return e.get(t+"/serverMonitor/detailTime")}function i(a){return e.put(t+"/status/set?value="+a)}function l(){return e.get(t+"/depDataInfo/dataInfoNum")}function c(){return e.get(t+"/depDataInfo/dataCount")}function s(){return e.get(t+"/sixApp/vehicle")}function d(){return e.get(t+"/sixApp/vehicleView")}function u(){return e.get(t+"/sixApp/civilServant")}function m(){return e.get(t+"/sixApp/governmentApprovalSystem")}function g(){return e.get(t+"/sixApp/meteorologicalObservationStation")}function p(){return e.get(t+"/sixApp/mos_maxTemperature")}function h(){return e.get(t+"/sixApp/mos_minTemperature")}function b(){return e.get(t+"/sixApp/mos_maxRainfall")}function f(){return e.get(t+"/sixApp/weatherForecast")}function v(){return e.get(t+"/sixApp/disasterWarning")}function y(){return e.get(t+"/sixApp/creditWebOne")}function _(){return e.get(t+"/sixApp/creditWebTwo")}function S(){return e.get(t+"/sixApp/creditWebThree")}function w(){return e.get(t+"/depDataInfo/industrialPolicy")}return{getDeptDataQuantity:a,getStatus:n,getIdcUse:o,getIdcUseTime:r,setStatus:i,getDataInfoNum:l,getDataCount:c,getVehicle:s,getVehicleView:d,getCivilServant:u,getGovernmentApprovalSystem:m,getMeteorologicalObservationStation:g,getMos_maxTemperature:p,getMos_minTemperature:h,getMos_maxRainfall:b,getWeatherForecast:f,getDisasterWarning:v,getCreditWebOne:y,getCreditWebTwo:_,getCreditWebThree:S,getIndustrialPolicy:w}}]),e.directive("wiservDockProgress",["dashboard.chartDockProgress",function(e){return{restrict:"ACE",template:"<div id='dockProgress'></div>",link:function(e,t,a){var n=screen.width,o=4;n<2e3&&(o=4),n<1600&&(o=3);var r={title:{text:"对接进度",left:"center",top:15,textStyle:{color:"rgb(0,225,252)",fontSize:8*o,fontWeight:"normal"}},tooltip:{trigger:"axis"},radar:[{indicator:[{text:"市民一卡通系统",max:70},{text:"气象观测系统",max:70,axisLabel:!1},{text:"成都市公共气象服务平台",max:70,axisLabel:!1},{text:"公务员管理系统",max:70,axisLabel:!1},{text:"综合执法智慧服务平台",max:70,axisLabel:!1},{text:"成都市企业信用系统 ",max:70,axisLabel:!1},{text:"成都崇州行政审批系统 ",max:70,axisLabel:!1},{text:"数字化城管系统 ",max:70,axisLabel:!1},{text:"省行权平台 ",max:70,axisLabel:!1}],center:["52%","55%"],radius:50*o,splitNumber:7,name:{formatter:"{value}",textStyle:{color:"rgba(220, 220, 220, 1)",fontSize:4*o}},splitArea:{areaStyle:{color:["transparent"],shadowColor:"rgba(0, 0, 0, 0.3)",shadowBlur:10}},axisLine:{show:!1,lineStyle:{color:"rgba(255, 255, 255, 0.5)"}},splitLine:{lineStyle:{color:"rgba(204, 204, 204, 0.3)"}},axisLabel:{show:!0,formatter:"{value}%",textStyle:{color:"#DDD"}}}],series:[{name:"雷达图",type:"radar",tooltip:{trigger:"item"},itemStyle:{emphasis:{lineStyle:{width:4}}},data:[{value:[60,30,60,10,50,20,68,50,10],name:"对接进度",symbolSize:5,lineStyle:{normal:{color:"rgb(69,128,180)",width:2,shadowColor:"rgb(94,154,208)",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:12}},itemStyle:{normal:{color:"rgb(69,128,180)"}}}]}]},i=echarts.init(t.find("#dockProgress")[0]);setTimeout(function(){var e=t.find("#dockProgress")[0].clientWidth;$("#dockProgress").css({width:e}),i.clear(),i.resize(),i.setOption(r)},1e3)}}}]),e.directive("wiservDockDataset",["dashboard.chartDockDataset",function(e){return{restrict:"ACE",template:"<div id='dockDataset'></div>",link:function(e,t,a){var n=screen.width,o=4;n<2e3&&(o=4),n<1600&&(o=3);var r={title:{text:"对接后采集到平台的数据项",left:"center",top:48,textStyle:{color:"rgb(0,225,252)",fontSize:8*o,fontWeight:"normal"}},color:["#3398DB"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{top:"24%",left:"3%",right:"4%",bottom:"20%",containLabel:!0},xAxis:[{type:"category",data:["市民一卡通系统","省行权平台","数字化城管系统","成都崇州行政审批系统","成都市企业信用系统","综合执法智慧服务平台","公务员管理系统","成都市公共气象服务平台","气象观测系统"],axisTick:{alignWithLabel:!0},axisLabel:{rotate:45,interval:0,textStyle:{color:"rgba(220, 220, 220, 1)",fontSize:4*o}},axisLine:{lineStyle:{color:"rgba(204, 204, 204, 0.5)"}}}],yAxis:[{type:"value",axisTick:{show:!1},axisLine:{show:!1},axisLabel:{textStyle:{color:"rgba(220, 220, 220, 1)",fontSize:3*o}},splitLine:{lineStyle:{color:["rgba(204, 204, 204, 0.5)"]}}}],series:[{name:"采集数据项",type:"bar",barWidth:"45%",label:{normal:{show:!0,position:"top",textStyle:{color:"rgba(240, 240, 240, 1)",fontSize:3*o}}},itemStyle:{normal:{color:"rgb(0,112,192)",shadowColor:"rgb(8, 152, 255)",shadowBlur:8}},data:[16,5,15,4,16,28,18,37,24]}]},i=echarts.init(t.find("#dockDataset")[0]);setTimeout(function(){var e=t.find("#dockDataset")[0].clientWidth;$("#dockDataset").css({width:e}),i.clear(),i.resize(),i.setOption(r)},2e3)}}}]),e.directive("wiservChartCar",["dashboardService","$interval",function(e,t){return{restrict:"ACE",template:"<div id='carData' style='width:100%;height:100%'></div>",link:function(a,n,o){function r(){e.getVehicleView().then(function(e){var t=e.data.body;t&&0!=t.length?localStorage.setItem("vehicleView",JSON.stringify(t)):(t=JSON.parse(localStorage.getItem("vehicleView")),l=!1);var a=_.map(t,"_id"),n=[],o=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],r=!0;_.forEach(o,function(e,o){var i={};i.name=e;var l=_.indexOf(a,e);l>-1?(i.value=t[l].count,0!=i.value&&(r=!1)):i.value=0,n.push(i)}),console.log(n);var c={title:{text:"前一天消费趋势图（笔）",left:"3%",textStyle:{fontSize:30,fontWeight:"normal",color:"rgb(237,252,2)"}},tooltip:{trigger:"axis"},grid:{left:"3%",top:"20%",bottom:"40%",right:"35%"},xAxis:{type:"category",boundaryGap:!1,axisTick:{show:!1},axisLine:{lineStyle:{color:"rgb(8,88,123)"}},axisLabel:{textStyle:{color:"rgba(255,255,255,.6)",fontSize:22}},data:o},yAxis:{type:"value",boundaryGap:!1,axisLabel:{margin:15,textStyle:{color:"rgba(255,255,255,.6)",fontSize:22}},axisLine:{lineStyle:{color:"rgb(8,88,123)"}},splitLine:{lineStyle:{width:2,color:"rgb(8,88,123)"}}},series:[{name:"前一天消费(笔)",type:"line",stack:"总量",data:n,symbolSize:6,itemStyle:{normal:{color:"rgb(237,252,2)",shadowColor:"#FFF",shadowBlur:6}},lineStyle:{normal:{width:3,color:"rgb(237,252,2)"}}}]};l&&r||(l=!0,i.clear(),i.setOption(c))})}var i=echarts.init(n.find("#carData")[0]),l=!1;r(),t(function(){r()},864e5)}}}]),e.directive("wiservMapText",["dashboardService",function(e){return{restrict:"ACE",template:'<canvas id="myCanvas" ></canvas>',link:function(e,t,a){function n(e,t,a,n,o,r){var i,l=t.length;e.save(),e.translate(a,n),e.rotate(-1*r/2),e.rotate(-10*(r/l));for(var c=0;c<l;c++)e.rotate(r/l),e.save(),e.translate(0,-1*o),i=t[c],e.fillText(i,0,0),e.restore();e.restore()}setTimeout(function(){var e=t.parent()[0].clientHeight,a=t.parent()[0].offsetHeight;$(t.find("canvas")).attr("width",a),$(t.find("canvas")).attr("height",a);var o=4;e>700&&(o=5);var r=document.getElementById("myCanvas"),i=r.getContext("2d"),l=r.width/2+24,c=r.height/2+16,s=Math.PI/o,d=a/2;i.font="26px Calibri",i.textAlign="center",i.fillStyle="#FFF",i.strokeStyle="transparent",i.lineWidth=0,n(i,"社会化数据",l,c,d,s),i.arc(l,c,d-10,0,2*Math.PI,!1),i.stroke()},600)}}}]),e.directive("wiservMapTextDown",["dashboardService",function(e){return{restrict:"ACE",template:'<canvas id="downCanvas" ></canvas>',link:function(e,t,a){function n(e,t,a,n,o,r,i){var l,c=t.length;e.save(),e.translate(a,n),e.rotate(-1*r/1.5),e.rotate(i*(r/c));for(var s=0;s<c;s++)e.rotate(r/c),e.save(),e.translate(0,-1*o),l=t[s],e.fillText(l,0,0),e.restore();e.restore()}setTimeout(function(){var e=t.parent()[0].clientHeight,a=t.parent()[0].offsetHeight;$(t.find("canvas")).attr("width",a),$(t.find("canvas")).attr("height",a);var o=4,r=12;e>700&&(o=6,r=19);var i=document.getElementById("downCanvas"),l=i.getContext("2d"),c=i.width/2-20,s=i.height/2-30,d=Math.PI/o,u=a/2;l.font="26px Calibri",l.textAlign="center",l.fillStyle="#FFF",l.strokeStyle="transparent",l.lineWidth=0,n(l,"政务数据",c,s,u,d,r),l.arc(c,s,u-10,0,2*Math.PI,!1),l.stroke()},600)}}}]),e.directive("wiservMapChart",[function(){return{restrict:"ACE",template:"<svg ></svg>",link:function(e,t,a){function n(e,t){var a=(e-90)/180*Math.PI,n=t;return[-n*Math.cos(a),-n*Math.sin(a)]}setTimeout(function(){var e=t.parent()[0].clientHeight,a=t.parent()[0].offsetHeight;$(t.parent()[0]).css("width",a+"px"),$(t.parent()[0]).css("height",a+"px"),$(t.find("svg")[0]).attr("width",e),$(t.find("svg")[0]).attr("height",e);var o=d3.select(t.find("svg")[0]),r=+o.attr("width"),i=+o.attr("height"),l=o.append("g").attr("transform","translate("+r/2+","+i/2+")"),c=d3.stratify().parentId(function(e){return e.id.substring(0,e.id.lastIndexOf("."))}),s=[285,150];e>700&&(s=[285,230]);var d=d3.tree().size(s).separation(function(e,t){return e.parent==t.parent,1/e.depth});d3.csv("assets/file/flare.csv",function(e,t){if(e)throw e;var a=d(c(t)),o=(l.selectAll(".link").data(a.descendants().slice(1)).enter().append("path").attr("class","link").attr("d",function(e){return"M"+n(e.x,e.y)+"C"+n(e.x,(e.y+e.parent.y)/1.8)+" "+n(e.parent.x,(e.y+e.parent.y)/3)+" "+n(e.parent.x,e.parent.y/1.1)}),l.selectAll(".node").data(a.descendants()).enter().append("g").attr("class",function(e){return"node"+(e.children?" node--internal":" node--leaf")}).attr("transform",function(e){return e.children?"translate("+n(e.x,e.y/1.1)+")":"translate("+n(e.x,e.y)+")"}));o.append("circle").attr("r",9.5),o.append("text").attr("dy",".31em").attr("x",function(e){return e.x<180==!e.children?-12:12}).style("text-anchor",function(e){return e.x<180==!e.children?"end":"start"}).attr("transform",function(e){return"rotate("+(e.x<180?e.x-90:e.x+90)+")"}).text(function(e){return e.id.substring(e.id.lastIndexOf(".")+1)})})},600)}}}]),e.directive("wiservStandardSection",function(){return{restrict:"A",templateUrl:"partials/standard/view.html",replace:!0}}),e.directive("wiservCenterSection",function(){return{restrict:"A",templateUrl:"partials/center/view.html",replace:!0}}),e.directive("wiservDeptSection",function(){return{restrict:"A",templateUrl:"partials/dept/view.html",replace:!0}}),e.directive("wiservSupportSection",function(){return{restrict:"A",templateUrl:"partials/support/view.html",replace:!0}}),e.directive("wiservDatamapSection",function(){return{restrict:"A",templateUrl:"partials/datamap/view.html",replace:!0}}),e.directive("wiservIdcuseSection",function(){return{restrict:"A",templateUrl:"partials/idcuse/view.html",replace:!0}}),e.directive("wiservBigdataSection",function(){return{restrict:"A",templateUrl:"partials/bigdata/view.html",replace:!0}}),e.directive("wiservDashboard",["$location",function(e){return{restrict:"A",templateUrl:"partials/dashboard/part.html",replace:!0,link:function(t,a,n){var o=(screen.width,screen.height),r=e.path();r.indexOf("main")>-1&&$(".section").css({height:o/2+"px"})}}}]),e.directive("wiservImagePlay",["$location",function(e){return{restrict:"A",templateUrl:"partials/support/sub.html",replace:!0,link:function(e,t,a){t.slick({slidesToShow:4,slidesToScroll:1,autoplay:!0,autoplaySpeed:3e3})}}}]),e.directive("wiservImagePlaydown",["$location",function(e){return{restrict:"A",templateUrl:"partials/support/subdown.html",replace:!0,link:function(e,t,a){t.slick({slidesToShow:4,slidesToScroll:1,autoplay:!0,autoplaySpeed:3e3})}}}])}(),function(){var e=angular.module("app.dept",[]);e.$inject=["$location"],e.controller("deptController",["$scope","deptService","$rootScope","$interval","$timeout",function(e,t,a,n,o){function r(){i()}e.toggleMap=0,e.update_date=new Date,e.reqDone="hidden",e.allow_toggle=!0,e.mouseEnter=function(){e.allow_toggle=!1},e.mouseLeave=function(){e.allow_toggle=!0},e.toggleDept=function(){if(e.allow_toggle){var t=angular.copy(e.toggleMap);e.toggleMap=(t+1)%3,1==e.toggleMap&&(_.forEach(e.deptAccessData,function(e){e.i_width="0%"}),o(function(){_.forEach(e.deptAccessData,function(t){t.i_width=t.dataNum/e.deptAccessMax*100+"%"}),$(".dept-access-rank").slick("slickGoTo",0)},1e3))}},e.deptToggleClick=function(){e.allow_toggle=!0,e.toggleDept()},n(function(){e.toggleDept()},3e4),n(function(){i(),e.update_date=new Date},36e5);var i=function(){t.getDataCountLast().then(function(t){e.dataCountLast=t.data.body}),t.getResourceCombing().then(function(t){e.ResourceCombing=t.data.body[0],o(function(){$(".profile-right-wrap").slick({slidesToShow:2,slidesToScroll:1,autoplay:!0,autoplaySpeed:2500}),$(".profile-right-wrap").on("afterChange",function(){o(function(){e.reqDone="visible"},2e3)})},200)}),t.getAccessDataNum().then(function(t){e.deptAccessData=t.data.body,e.deptAccessMax=_.max(_.map(e.deptAccessData,"dataNum"))+30,_.forEach(e.deptAccessData,function(t){t.i_width=t.dataNum/e.deptAccessMax*100+"%"}),o(function(){$(".dept-access-rank").slick({slidesToShow:8,slidesToScroll:1,autoplay:!0,autoplaySpeed:2500,vertical:!0,verticalSwiping:!0})},10)})};r()}]),e.factory("deptService",["$http","URL",function(e,t){function a(){return e.get(t+"/depDataInfo/dataCountLast")}function n(){return e.get(t+"/combing/ResourceCombing")}function o(){return e.get(t+"/depDataInfo/accessDataNum")}function r(){return e.get("assets/file/depts_coord.json")}function i(){return e.get("assets/file/dept_contract.json")}return{getDataCountLast:a,getResourceCombing:n,getAccessDataNum:o,getDeptCoords:r,getDeptContract:i}}]),e.directive("wiservChartMigrate",["deptService",function(e){return{restrict:"ACE",template:"<div id='deptData' style='width:100%;height:100%'></div>",link:function(t,a,n){var o=echarts.init(a.find("#deptData")[0]);e.getDeptCoords().then(function(e){function t(e,t,a,n){var o=[];if(n)for(var r=0,i=t.length;r<i;r++)a!=t[r].name&&o.push({coords:[e[a],e[t[r].name]]});else for(var r=0,i=t.length;r<i;r++)a!=t[r].name&&("成都市政务中心"==t[r].name||"成都市气象局"==t[r].name||"成都市工商局"==t[r].name||("成都市政府部门"==t[r].name?o.push({coords:[e[t[r].name],e[a]],lineStyle:{normal:{color:"rgb(103,254,0)"}}}):o.push({coords:[e[t[r].name],e[a]]})));return o}function a(e,t,a){for(var n=[],o=0,r=t.length;o<r;o++){var i=t[o].name;a!=i&&("成都市政府部门"==i?n.push({name:i,value:e[i],symbolSize:16,itemStyle:{normal:{color:"rgb(103,254,0)"}},label:{normal:{position:[-150,-60],textStyle:{color:"#FFF",fontSize:24,fontWeight:100}}}}):"成都市政务中心"==i||"成都市气象局"==i||"成都市工商局"==i?n.push({name:i,value:e[i],symbolSize:.001,label:{normal:{position:d}}}):e[i][0]>91&&e[i][0]<119&&e[i][1]<21?n.push({name:i,value:e[i],symbolSize:6,label:{normal:{position:[-30,22]}},itemStyle:{normal:{color:"rgb(255,241,81)"}}}):e[i][0]<=91?n.push({name:i,value:e[i],symbolSize:6,label:{normal:{position:[-80,-5]}},itemStyle:{normal:{color:"rgb(238,141,9)"}}}):n.push({name:i,value:e[i],symbolSize:6}))}return n.push({name:a,value:e[a],symbolSize:16,label:{normal:{position:[-100,-60],textStyle:{color:"#FFF",fontSize:24,fontWeight:100}}},itemStyle:{normal:{color:"rgb(255,234,1)"}}}),n}var n=e.data.coords,r=e.data.data,i="circle",l=.8,c=["38%","45%"],s=15,d=[60,-5],u=screen.width;screen.height;u<1600&&(l=.6,c=["29%","35%"],s=14,d=[15,-8]);var m={backgroundColor:"transparent",title:{text:"",left:"5",top:"10px",itemStyle:{normal:{borderColor:"rgba(100,149,237,1)",borderWidth:.5,areaStyle:{color:"#1b1b1b"}}}},tooltip:{trigger:"item"},geo:{map:"china",show:!1,zoom:l,layoutCenter:c,layoutSize:"100%",left:"2%",label:{emphasis:{show:!1}},roam:!0,silent:!0,itemStyle:{normal:{areaColor:"transparent",borderColor:"#000"},emphasis:{areaColor:"#2a333d"}}},series:[{type:"lines",zlevel:2,silent:!0,effect:{show:!0,period:6,trailLength:.005,color:"rgba(255,255,255,.8)",symbol:i,symbolSize:4},lineStyle:{normal:{color:"#a6c84c",width:1,opacity:.4,curveness:.2,shadowColor:"rgb(255,241,81)",shadowBlur:10}},data:t(n,r,"崇州市数据共享交换平台",!1)},{type:"effectScatter",coordinateSystem:"geo",zlevel:2,silent:!0,rippleEffect:{period:4,scale:3,brushType:"stroke"},label:{normal:{show:!0,position:[24,-5],formatter:"{b}",textStyle:{fontSize:s,fontFamily:"yahei",fontWeight:100}}},symbolSize:4,itemStyle:{normal:{color:"rgb(2,255,29)",shadowBlur:35,shadowColor:"rgba(2,255,29,1)",opacity:.6}},data:a(n,r,"崇州市数据共享交换平台")}]};o.setOption(m)})}}}]),e.directive("wiservChartContract",["deptService",function(e){return{restrict:"ACE",template:"<div id='deptData' style='width:100%;height:100%'></div>",link:function(t,a,n){var o=echarts.init(a.find("#deptData")[0]);e.getDeptContract().then(function(e){function t(e,t,a,n){var o=[];if(n)for(var r=0,i=t.length;r<i;r++)a!=t[r].name&&o.push({coords:[e[a],e[t[r].name]]});else for(var r=0,i=t.length;r<i;r++)a!=t[r].name&&("成都医保数据"==t[r].name||"舆情数据"==t[r].name||"行政审批数据"==t[r].name?"行政审批数据"==t[r].name?o.push({coords:[e[a],e[t[r].name]],lineStyle:{normal:{curveness:.18}}}):"成都医保数据"==t[r].name?o.push({coords:[e[a],e[t[r].name]],lineStyle:{normal:{curveness:.3}}}):o.push({coords:[e[a],e[t[r].name]]}):o.push({coords:[e[t[r].name],e[a]]}));return o}function a(e,t,a){for(var n=[],o=0,r=t.length;o<r;o++){var i=t[o].name;a!=i&&("国家资源卫星数据"==i?n.push({name:i,value:e[i],symbol:"circle",symbolSize:14,label:{normal:{position:[-80,-100]}}}):"成都工商数据"==i?n.push({name:i,value:e[i],symbolSize:14,label:{normal:{align:"right",position:[-30,30],rich:{b:{align:"right"},c:{align:"right"}}}}}):"社会信用数据"==i?n.push({name:i,value:e[i],symbolSize:14,label:{normal:{align:"right",position:[-0,25]}}}):"行政审批数据"==i?n.push({name:i,value:e[i],symbolSize:14,label:{normal:{position:[-20,35]}}}):"知识产权数据"==i?n.push({name:i,value:e[i],symbolSize:14,label:{normal:{position:[40,-70]}}}):"成都医保数据"==i?n.push({name:i,value:e[i],symbolSize:14,label:{normal:{position:[25,-10]}}}):n.push({name:i,value:e[i],symbolSize:14,label:{normal:{position:[30,-30]}}}))}return n.push({name:a,value:e[a],symbol:"image://"+location.protocol+"//"+location.host+"/CZPortal/assets/images/sign.png",symbolSize:50,label:{normal:{position:[20,-80],rich:{a:{color:"#edfc02",fontSize:26}}}},itemStyle:{normal:{color:"rgb(255,234,1)"}}}),n}var n=e.data.coords,r=e.data.data,i="circle",l=.8,c=["38%","45%"],s=20,d=[60,-5],u=screen.width;screen.height;u<1600&&(l=.6,c=["29%","35%"],s=18,d=[15,-8]);var m={backgroundColor:"transparent",title:{text:"",left:"5",top:"10px",itemStyle:{normal:{borderColor:"rgba(100,149,237,1)",borderWidth:.5,areaStyle:{color:"#1b1b1b"}}}},tooltip:{trigger:"item"},geo:{map:"china",show:!1,zoom:l,layoutCenter:c,layoutSize:"100%",left:"2%",label:{emphasis:{show:!1}},roam:!0,silent:!0,itemStyle:{normal:{areaColor:"transparent",borderColor:"#000"},emphasis:{areaColor:"#2a333d"}}},series:[{type:"lines",zlevel:2,silent:!0,effect:{show:!1,period:6,trailLength:.005,color:"rgba(255,255,255,.8)",symbol:i,symbolSize:4},lineStyle:{normal:{color:"rgb(18,236,252)",width:2,opacity:1,curveness:.35,shadowColor:"rgb(18,236,252)",shadowBlur:10}},data:t(n,r,"崇州市数据共享交换平台",!1)},{type:"effectScatter",coordinateSystem:"geo",
zlevel:2,silent:!0,rippleEffect:{period:10,scale:3,brushType:"stroke"},label:{normal:{show:!0,position:[24,-5],formatter:function(e){var t=e.name.split("\n");return t.length>1?t.length>2?"{a|"+t[0]+"}\n{b|"+t[1]+"}{c|"+t[2]+"}":"{a|"+t[0]+"}\n{b|"+t[1]+"}":"{a|"+t[0]+"}"},rich:{a:{color:"#3bbbf0",fontSize:26,lineHeight:40},b:{color:"#3bbbf0",fontSize:26,fontFamily:"digiFont",verticalAlign:"bottom",padding:[0,10,0,0]},c:{color:"#3bbbf0",fontSize:20,verticalAlign:"bottom"}},textStyle:{color:"#3bbbf0",fontSize:20,fontFamily:"digiFont",fontWeight:100}}},symbolSize:4,itemStyle:{normal:{color:"rgb(18,236,252)",shadowBlur:35,shadowColor:"rgba(2,255,29,1)",opacity:1}},data:a(n,r,"崇州市数据共享交换平台")}]};o.setOption(m)})}}}])}(),function(){var e=angular.module("app.catalog",[]);e.controller("catalogController",["$scope","catalogService","$rootScope","$interval","$timeout",function(e,t,a,n,o){function r(t){e.DeptCataData={},e.TownCataData={};var a=t.data.body,n=_.groupBy(a,function(e){return e.dept_type}),o=n.C,r=n.Z,i=_.union(o,r);e.data1=i,e.data2=n.X,e.lens=e.data1.length,e.len2=e.data2.length,e.data_total_length=e.data1.length+e.data2.length,e.active_index=Math.floor(e.lens-e.data_total_length/4),e.active_index_down=Math.floor(e.data_total_length/4);for(var l=0;l<e.data_total_length;l++)e.data1[l]||e.data1.push({dept_short_name:"",dept_code:"",num:"",dept_type:""}),e.data2[l]||e.data2.push({dept_short_name:"",dept_code:"",num:""})}var i=screen.width,l=(screen.height,{x:530,y:670,radius:320,radius_inner:310});a.center_canvas_width="1060",a.center_canvas_height="1360",i<1921&&(a.center_canvas_width="780",a.center_canvas_height="940",l.y=470,l.radius_inner=200,i<1400&&(a.center_canvas_width="540",a.center_canvas_height="670",l.y=335,l.radius_inner=145),l.x=a.center_canvas_width/2);var c={normal:"rgb(31,234,193)",num_bg:"rgba(50,193,253,.23)",num:"#09a1df",num_active_bg:"rgb(51,178,127)",num_active:"#FFF"},s={normal:"rgb(9,161,223)",num_bg:"rgba(50,193,253,.23)",num:"rgb(50,193,253)",num_active_bg:"rgb(62,136,236)",num_active:"#FFF"};e.data1=["市安监局","市财政局","市城管局","市地税局","市发改局","市法制办","市公安局","市规划局","市国税局","市国土局","市环保局","市交通局","市教育局","市经信局","市民政局","市农发局","市气象局","市人社局","市商投局","市审计局","市市场监管","市水务局","市司法局","市统计局","市卫计局","市文旅局","市政务中心","市住建局","市综合执法","崇信大数据","市供电分公司"],e.data2=["崇阳街道","羊马镇","崇平镇","梓潼镇","廖家镇","三江镇","江源镇","大划镇","王场镇","白头镇","道明镇","济协乡","隆兴镇","桤泉镇","集贤乡","燎原乡","元通镇","观胜镇","锦江乡","公议乡","怀远镇","街子镇","三郎镇","文井江镇","鸡冠山乡"],e.data_number1=["256","301","145","344","53","256","301","145","344","53","301","145","344","53","256","53","256","301","145","344","53","256","53","256","301","145","344","145","344","53","45"],e.data_number2=["301","145","344","53","256","53","256","301","145","344","53","256","53","256","301","145","344","145","344","53","53","256","301","145","344"],e.data_code1=[],e.data_code2=[],e.DeptCataData={},e.TownCataData={},e.active_index=0,e.active_index_down=0;var d=null;t.getDeptCatalog().then(function(a){a&&a.data&&(r(a),setTimeout(function(){function a(t){1==t&&(e.data1.splice(0,0,e.data1[e.lens-1]),e.data1.splice(e.lens,1)),2==t&&(e.data2.splice(0,0,e.data2[e.len2-1]),e.data2.splice(e.len2,1))}function o(t,n,o,r,i){var u=l.radius_inner,m=l.x,g=l.y,p=3e3,h=p,b=r,f=b+o;!function(){fabric.util.animate({startValue:b,endValue:f,duration:h,easing:fabric.util.ease.easeOutBounce,onChange:function(i){var l=i;i=fabric.util.degreesToRadians(i);var p=m+u*Math.cos(i),h=g+u*Math.sin(i);t.set({left:p,top:h,angle:r+o}).setCoords(),e.active_index==n&&1==t.g_type&&(t.dept_data.set({fill:c.num_active}),t.bg_rect.set({fill:c.num_active_bg}),t.dept_number.set({fill:c.num_active})),e.active_index_down==n&&2==t.g_type&&(t.dept_data.set({fill:s.num_active}),t.bg_rect.set({fill:s.num_active_bg}),t.dept_number.set({fill:s.num_active})),"Z"==t.dept_data.dept_type&&t.dept_data.set({fill:"#c8eb24"}),n===e.data_total_length-1&&(l==f&&(1==t.g_type&&a(1),2==t.g_type&&a(2)),d.renderAll())},onComplete:function(){}})}()}function r(e,t,a,n,o,r,d){var u=c.num_bg,m=c.normal,g=c.num,p=20,h=145,b=42,f=26;i<1921&&(p=16,h=120),i<1400&&(p=10,h=80,b=26,f=18),2==e&&(m=s.normal),""==a.num&&(u="transparent"),"Z"==a.dept_type&&(m="#c8eb24");var v=new fabric.Rect({width:b,height:f,fill:u,originX:"left",originY:"left",rx:6,ry:6,centeredRotation:!0}),y=new fabric.Text(""+a.num,{fontSize:p,fill:g,originX:n,originY:"center",centeredRotation:!0,left:3,angle:o}),_=new fabric.Group([v,y],{centeredRotation:!0,selectable:!1,hasControls:!1,hoverCursor:"pointer",left:h}),S=new fabric.Text(a.dept_short_name,{centeredRotation:!0,fontSize:p+3,dept_code:a.dept_code,dept_type:a.dept_type,fill:m,originX:n,originY:"center",angle:o}),w=new fabric.Group([S,_],{centeredRotation:!0,subtargets:!1,selectable:!1,hasControls:!1,hoverCursor:"pointer",left:l.x+Math.round(l.radius_inner*Math.cos(d)),top:l.y+Math.round(l.radius_inner*Math.sin(d)),angle:r});return w.dept_data=S,w.dept_number=y,w.bg_rect=v,w.g_type=e,w.g_index=t,w}function u(a,n,o){1==a?e.DeptCataData.deptName=o:e.TownCataData.deptName=o,t.getDataByDept({dept_code:n}).then(function(t){if(t&&t.data&&t.data.body){var n=t.data.body[0].num;1==a?e.DeptCataData.catalog=n:e.TownCataData.catalog=n}}),t.getDataItemByDept({dept_code:n}).then(function(t){if(t&&t.data&&t.data.body){var n=t.data.body[0].num;1==a?e.DeptCataData.dataItem=n:e.TownCataData.dataItem=n}}),t.getSystemByDept({dept_code:n}).then(function(t){if(t&&t.data&&t.data.body){var n=t.data.body[0].num;1==a?e.DeptCataData.system=n:e.TownCataData.system=n}}),t.getResByDept({dept_code:n}).then(function(t){if(t&&t.data&&t.data.body){var n=t.data.body[0].num;1==a?e.DeptCataData.resource=n:e.TownCataData.resource=n}})}function m(){t.getDataCountLast().then(function(t){e.dataCountLast=t.data.body}),t.getInvokeNum().then(function(t){e.invokeNum=t.data.body[0].num})}function g(){e.draw(),u(1,_.map(e.data1,"dept_code")[e.active_index],_.map(e.data1,"dept_short_name")[e.active_index]),u(2,_.map(e.data2,"dept_code")[e.active_index_down],_.map(e.data2,"dept_short_name")[e.active_index_down]),m(),e.timer1=n(function(){e.draw(),u(1,_.map(e.data1,"dept_code")[e.active_index],_.map(e.data1,"dept_short_name")[e.active_index]),u(2,_.map(e.data2,"dept_code")[e.active_index_down],_.map(e.data2,"dept_short_name")[e.active_index_down])},5e3)}d=this.__canvas=new fabric.Canvas("mycanvas");var p=360/e.data_total_length;e.draw=function(){d.clear();for(var t=e.data_total_length-1;t>=0;t--){var a=Math.ceil(e.data_total_length/4)+.5,n=(t+(e.len2-a))*p,i=(t+(e.len2-a))*p*Math.PI/180,s=(t-a)*p,u=(t-a)*p*Math.PI/180,m=0,g=2,h="left",b="left";new fabric.Rect({width:50,height:26,centeredRotation:!0,fill:c.num_bg,originX:"center",originY:"center",rx:6,ry:6,left:l.x+Math.round(l.radius_inner*Math.cos(i)),top:l.y+Math.round(l.radius_inner*Math.sin(i)),angle:n});Math.cos(i)>0||(m=180,h="right");var f=r(1,t,e.data1[t],h,m,n,i);d.add(f),o(f,t,p,n,e.lens);var v=r(2,t,e.data2[t],b,g,s,u);d.add(v),o(v,t,p,s,e.len2)}},g(),d.on("mouse:over",function(t){var a=t.target;(a&&a.dept_data||a&&a.dept_number)&&(n.cancel(e.timer1),e.timer1=null,1==a.g_type&&""!=a.dept_data.text&&("Z"!=a.dept_data.dept_type&&a.dept_data.set({fill:c.num_active}),a.bg_rect.set({fill:c.num_active_bg}),a.dept_number.set({fill:c.num_active})),2==a.g_type&&""!=a.dept_data.text&&(a.dept_data.set({fill:s.num_active}),a.bg_rect.set({fill:s.num_active_bg}),a.dept_number.set({fill:s.num_active}))),d.renderAll()}),d.on("mouse:out",function(t){var a=t.target;(a&&a.dept_data||a&&a.dept_number)&&(1==a.g_type&&""!=a.dept_data.text&&e.active_index!=a.g_index&&("Z"!=a.dept_data.dept_type&&a.dept_data.set({fill:c.normal}),a.dept_number.set({fill:c.num}),a.bg_rect.set({fill:c.num_bg})),2==a.g_type&&""!=a.dept_data.text&&e.active_index_down!=a.g_index&&(a.dept_data.set({fill:s.normal}),a.dept_number.set({fill:s.num}),a.bg_rect.set({fill:s.num_bg})),n.cancel(e.timer1),e.timer1=n(function(){e.draw(),u(1,_.map(e.data1,"dept_code")[e.active_index],_.map(e.data1,"dept_short_name")[e.active_index]),u(2,_.map(e.data2,"dept_code")[e.active_index_down],_.map(e.data2,"dept_short_name")[e.active_index_down])},5e3)),d.renderAll()}),d.on("mouse:down",function(e){var t=e.target;(t&&t.dept_data||t&&t.dept_number)&&""!=t.dept_data.text&&u(t.g_type,t.dept_data.dept_code,t.dept_data.text)})},500))}),n(function(){t.getDeptCatalog().then(function(e){r(e)})},864e5)}]),e.factory("catalogService",["$http","URL",function(e,t){function a(){return e.get(t+"/combing/deptInfo")}function n(a){return e.get(t+"/combing/dirNum",{params:a})}function o(a){return e.get(t+"/combing/itemNum",{params:a})}function r(a){return e.get(t+"/combing/systemNum",{params:a})}function i(a){return e.get(t+"/depDataInfo/dataSetNum",{params:a})}function l(){return e.get(t+"/depDataInfo/dataCountLast")}function c(){return e.get(t+"/depDataInfo/subjectInfo")}function s(){return e.get(t+"/depDataInfo/themeInfo")}function d(){return e.get(t+"/depDataInfo/invokeNumByApp")}return{getDeptCatalog:a,getDataByDept:n,getDataItemByDept:o,getSystemByDept:r,getResByDept:i,getDataCountLast:l,getThemeData:c,getThemeRank:s,getInvokeNum:d}}]),e.directive("wiservThemeRank",["catalogService","$interval",function(e,t){return{restrict:"ACE",template:"<div id='themeRank' style='width:700px;height:500px'></div>",link:function(a,n,o){var r=screen.width;a.grid_bottom=80,a.grid_top=-15,a.grid_left=160,a.grid_right=160,a.symbol_margin="50%",a.fontSize=22,a.symbolSize=[5,30],e.getThemeRank().then(function(o){function i(e){var t=_.sortBy(e.data.body,function(e){return-e.num});a.themeNameAll=_.map(t,"themeName"),a.themeDataAll=_.map(t,"num");var n=_.max(a.themeDataAll)+10;a.data_length=a.themeNameAll.length;var o=angular.copy(a.themeNameAll),r=angular.copy(a.themeDataAll);o.splice(6,a.themeNameAll.length-6),r.splice(6,r.length-6),a.option={tooltip:{},xAxis:{max:n,splitLine:{show:!1},axisTick:{show:!1},axisLine:{show:!1}},yAxis:{data:o,inverse:!0,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{margin:25,textStyle:{color:"#09a1df",fontSize:a.fontSize}}},grid:{top:a.grid_top,left:a.grid_left,right:a.grid_right,bottom:a.grid_bottom},series:[{type:"pictorialBar",symbol:s,symbolRepeat:"fixed",symbolMargin:a.symbol_margin,symbolClip:!0,symbolSize:a.symbolSize,symbolBoundingData:n,data:r,z:10},{type:"pictorialBar",label:{normal:{show:!0,formatter:function(e){return e.value},position:"right",offset:[20,0],textStyle:{color:"#c8cbd7",fontSize:a.fontSize,align:"left",fontFamily:"digiFont"}}},animationDuration:0,symbolRepeat:"fixed",symbolMargin:a.symbol_margin,symbol:c,symbolSize:a.symbolSize,symbolBoundingData:n,data:r,z:5}]}}r<1921&&(n.find("#themeRank")[0].style.width="500px",a.grid_bottom=200,a.grid_top=-10,a.grid_left=120,a.grid_right=100,a.fontSize=18,a.symbolSize=[3,18],a.symbol_margin="60%"),r<1400&&(n.find("#themeRank")[0].style.width="360px",a.grid_bottom=300,a.grid_top=-6,a.grid_left=100,a.grid_right=100,a.fontSize=14,a.symbolSize=[2,14],a.symbol_margin="70%");var l=echarts.init(n.find("#themeRank")[0]),c="image://data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAlCAYAAACONvPuAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpjMzk2MzljYy1hMzRkLTU3NDktODM4Yy05Y2U4YjYxOGYwNmQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QTJEQzNBQ0ZFOUUwMTFFN0I0ODhBMUJCODhGRTI5MTEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTJEQzNBQ0VFOUUwMTFFN0I0ODhBMUJCODhGRTI5MTEiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ODc1NWY5ZjctZTA1Zi0yYzQ5LThmNTAtODQ0NjVkMGIzMWRhIiBzdFJlZjpkb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6YTUyODk2ODgtYTBhYy0xMWU2LWI3OWUtYTEyZjM3MGIwZTM1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+GjlvQQAAAGpJREFUeNpi5Fx4n5WBgUEGiMWA+D8QfwHiOyA2E5AQhUqAACMQ8wKxJIgDkhRnwAQSQMzFxIAbsOKTZBiVHFaS//BJ/h8NIdpK/sYn+RAUPWjiH4D4K0jyBxA/AuJfQPwXiL9DNfwHCDAAj8ITzGkC6NsAAAAASUVORK5CYII=",s="image://data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAlCAYAAACONvPuAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpjMzk2MzljYy1hMzRkLTU3NDktODM4Yy05Y2U4YjYxOGYwNmQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NURGNjAzQUZFOUVBMTFFN0I1N0FFMDc2OTQ1RjMzOTAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NURGNjAzQUVFOUVBMTFFN0I1N0FFMDc2OTQ1RjMzOTAiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ODc1NWY5ZjctZTA1Zi0yYzQ5LThmNTAtODQ0NjVkMGIzMWRhIiBzdFJlZjpkb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6YTUyODk2ODgtYTBhYy0xMWU2LWI3OWUtYTEyZjM3MGIwZTM1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+PWpIUgAAAG5JREFUeNpi5Fx4n5WBgUEaiE8CsRgQfwbiVCBexwQkeIF4M1SCAcqfCcSKIEkvINZhQAX8QDwNJMnIgB2IMzHgAaOSo5KjklSSfArE/7HI/QVJHgbiqegSQFwBM7YCiHcD8Qsg/gnEBUC8FyDAABIrEZcHojQvAAAAAElFTkSuQmCC";i(o),l.setOption(a.option);var d=0;t(function(){for(var e=a.option.series[0].data,t=(e.splice(0,1),a.option.yAxis.data.splice(0,1),0);t<1;t++)e.push(a.themeDataAll[(t+1*d+6)%a.data_length]),a.option.yAxis.data.push(a.themeNameAll[(t+1*d+6)%a.data_length]);d++,l.setOption(a.option)},3e3);t(function(){e.getThemeRank().then(function(e){i(e)})},864e5)})}}}]),e.directive("wiservChartTheme",["catalogService","$interval",function(e,t){return{restrict:"ACE",template:'<canvas id="bubblecanvas" width="780" height="710" ></canvas>',link:function(a,n,o){var r=screen.width,i=[],l=0;e.getThemeData().then(function(n){function o(e){fabric.util.animateColor("rgb(9,161,223)","rgb(200,235,36,1)",1500,{onChange:function(t){e.text_label.set("fill",t),e.text_number.set("fill",t),d.renderAll.bind(d)}}),e.text_label.animate({top:e.text_label.top-18},{duration:1500,onChange:d.renderAll.bind(d),onComplete:function(){},easing:function(e,t,a,n){return a*e/n+t}}),e.text_number.animate({top:e.text_number.top-15,opacity:1},{duration:1500,onChange:d.renderAll.bind(d),onComplete:function(){setTimeout(function(){e.text_label.animate({top:e.text_label.top+18},{duration:1500,onChange:d.renderAll.bind(d),easing:function(e,t,a,n){return a*e/n+t}}),e.text_number.animate({top:e.text_number.top+15,opacity:0},{duration:1500,onChange:d.renderAll.bind(d),easing:function(e,t,a,n){return a*e/n+t}}),fabric.util.animateColor("rgb(200,235,36,1)","rgb(9,161,223)",1500,{onChange:function(t){e.text_label.set("fill",t),e.text_number.set("fill",t)}}),d.renderAll()},1500)},easing:function(e,t,a,n){return a*e/n+t}})}function c(e,t,a,n,o,i,l,c){var s=45;r<1400&&(s=40);var d=new fabric.Circle({left:t,top:a,radius:e,fill:"#FFF"});d.setGradient("fill",{type:"radial",x1:e,y1:e,x2:e,y2:e,r1:d.width/2,r2:0,colorStops:{0:"rgb(6,88,127)",.05:"rgba(16,52,75,.8)",1:"rgba(16,52,75,1)"}});var u=new fabric.Text(n,{textAlign:"center",left:l,top:c,fill:"rgb(9,161,223)",fontSize:i+8,opacity:1}),o=new fabric.Text(o,{left:u.left-5,top:u.top+s+i,fill:"transparent",fontSize:i,opacity:0}),m=new fabric.Group([d,u,o],{centeredRotation:!0,selectable:!1,hasControls:!1,hoverCursor:"pointer",originX:"left"});return m.text_label=u,m.text_number=o,m}function s(e){var t=e.data.body;i=[];var a="";_.forEach(t,function(e){e.subjectName.length>11?(a=e.subjectName.substring(0,7),e.subjectName=a+"\n"+e.subjectName.substring(7,15)):(a=e.subjectName.substring(0,4),e.subjectName=a+"\n"+e.subjectName.substring(4,10))});var n=c(80,50,30,t[0].subjectName," 专题个数："+t[0].num,14,86,83),o=c(75,240,100,t[1].subjectName,"  专题个数："+t[1].num,13,275,153),l=c(103,410,0,t[2].subjectName,"   专题个数："+t[2].num,18,452,73),s=c(64,120,260,t[3].subjectName,"  专题个数："+t[3].num,10,150,305),u=c(86,320,260,t[4].subjectName," 专题个数："+t[4].num,16,358,315),m=c(72,540,200,t[5].subjectName,"        专题个数："+t[5].num,10,552,250);if(r<1921)var n=c(60,20,30,t[0].subjectName," 专题个数："+t[0].num,10,43,70),o=c(55,160,95,t[1].subjectName,"  专题个数："+t[1].num,9,180,132),l=c(70,300,0,t[2].subjectName,"    专题个数："+t[2].num,12,318,50),s=c(48,40,210,t[3].subjectName," 专题个数："+t[3].num,6,60,240),u=c(66,220,220,t[4].subjectName,"  专题个数："+t[4].num,12,247,262),m=c(58,370,170,t[5].subjectName,"       专题个数："+t[5].num,6,378,217);if(r<1400)var n=c(42,20,30,t[0].subjectName," 专题个数："+t[0].num,6,35,50),o=c(38,115,75,t[1].subjectName,"  专题个数："+t[1].num,5,128,100),l=c(50,200,0,t[2].subjectName,"    专题个数："+t[2].num,8,210,35),s=c(35,40,170,t[3].subjectName," 专题个数："+t[3].num,3,52,194),u=c(46,160,150,t[4].subjectName,"  专题个数："+t[4].num,6,178,182),m=c(42,270,120,t[5].subjectName,"       专题个数："+t[5].num,2,268,157);i.push(n),i.push(o),i.push(l),i.push(s),i.push(u),i.push(m),d.add(n),d.add(o),d.add(l),d.add(s),d.add(u),d.add(m)}var d=new fabric.Canvas("bubblecanvas");n&&n.data.body&&s(n),a.timer_theme=t(function(){o(i[l%6]),l++},4500),t(function(){e.getThemeData().then(function(e){d.clear(),s(e),l=0,t.cancel(a.timer_theme),a.timer_theme=t(function(){o(i[l%6]),l++},4500)})},864e5)})}}}])}();